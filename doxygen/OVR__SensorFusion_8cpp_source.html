<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Bike-X: ovr/sdk/src/OVR_SensorFusion.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bike-X
   &#160;<span id="projectnumber">0.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('OVR__SensorFusion_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OVR_SensorFusion.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="OVR__SensorFusion_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/************************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">Filename    :   OVR_SensorFusion.cpp</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">Content     :   Methods that determine head orientation from sensor data over time</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">Created     :   October 9, 2012</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">Authors     :   Michael Antonov, Steve LaValle, Dov Katz, Max Katsev, Dan Gierl</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">Copyright   :   Copyright 2014 Oculus VR, Inc. All Rights reserved.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">Licensed under the Oculus VR Rift SDK License Version 3.1 (the &quot;License&quot;); </span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">you may not use the Oculus VR Rift SDK except in compliance with the License, </span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">which is provided at the time of installation or download, or which </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">http://www.oculusvr.com/licenses/LICENSE-3.1 </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">Unless required by applicable law or agreed to in writing, the Oculus VR SDK </span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">limitations under the License.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*************************************************************************************/</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__SensorFusion_8h.html">OVR_SensorFusion.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__Log_8h.html">Kernel/OVR_Log.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__System_8h.html">Kernel/OVR_System.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__JSON_8h.html">OVR_JSON.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__Profile_8h.html">OVR_Profile.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__Stereo_8h.html">OVR_Stereo.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OVR__Recording_8h.html">OVR_Recording.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// Temporary for debugging</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="OVR__SensorFusion_8cpp.html#af2c2cc31e3591882ca6aed1135d31a8b">   36</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="OVR__SensorFusion_8cpp.html#af2c2cc31e3591882ca6aed1135d31a8b">Global_Flag_1</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//Convenient global variables to temporarily extract this data.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">   39</a></span>&#160;<span class="keywordtype">float</span>  <a class="code" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a>[4];</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="OVR__SensorFusion_8cpp.html#ab42b7452dd5114e43091c1772dd46039">   40</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="OVR__SensorFusion_8cpp.html#ab42b7452dd5114e43091c1772dd46039">TPH_CameraPoseConfidence</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="OVR__SensorFusion_8cpp.html#aa48eb9e8675069b80c3ba358eaeaa69b">   41</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="OVR__SensorFusion_8cpp.html#aa48eb9e8675069b80c3ba358eaeaa69b">TPH_CameraPoseConfidenceThresholdOverrideIfNonZero</a> = 0;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="OVR__SensorFusion_8cpp.html#a52715cbc385352dc231c7a4fc6093352">   42</a></span>&#160;<span class="keywordtype">bool</span>   <a class="code" href="OVR__SensorFusion_8cpp.html#a52715cbc385352dc231c7a4fc6093352">TPH_IsPositionTracked</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">namespace </span>OVR {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">const</span> <a class="code" href="namespaceOVR.html#a68a88999b443a66a52c47c075b84fa98">Transformd</a> <a class="code" href="namespaceOVR.html#a01fd8ceb7792c15a7870c1982ec009b4">DefaultWorldFromCamera</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0, 0, -1));</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// ***** Sensor Fusion</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#acb24e8da42b57d54759c8c546285082c">   52</a></span>&#160;<a class="code" href="classOVR_1_1SensorFusion.html#acb24e8da42b57d54759c8c546285082c">SensorFusion::SensorFusion</a>(<a class="code" href="classOVR_1_1SensorDevice.html">SensorDevice</a>* sensor)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  : ExposureRecordHistory(100), LastMessageExposureFrame(<a class="code" href="OVR__Linux__HMDDevice_8cpp.html">NULL</a>),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    FocusDirection(<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a>(0, 0, 0)), FocusFOV(0.0),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    FAccelInImuFrame(1000), FAccelInCameraFrame(1000), FAngV(20),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    EnableGravity(true), EnableYawCorrection(true), MagCalibrated(false),</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    EnableCameraTiltCorrection(true),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    MotionTrackingEnabled(true), VisionPositionEnabled(true),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    CenterPupilDepth(0.0)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;{</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a> = <span class="keyword">new</span> <a class="code" href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html">BodyFrameHandler</a>(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   <span class="comment">// And the clock is running...</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   <a class="code" href="namespaceOVR.html#a58837a8f196de4b8be986a876dc938f5">LogText</a>(<span class="stringliteral">&quot;*** SensorFusion Startup: TimeSeconds = %f\n&quot;</span>, <a class="code" href="classOVR_1_1Timer.html#a31feb8884a8d8bb8b7ca76d4e40e8a88">Timer::GetSeconds</a>());</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   <span class="keywordflow">if</span> (sensor)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;       <a class="code" href="classOVR_1_1SensorFusion.html#a2e5cf55702a25041ce105ebafdf0bfe5">AttachToSensor</a>(sensor);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   <a class="code" href="classOVR_1_1SensorFusion.html#a87b974dd00d2eb452930a0363760a01e">Reset</a>();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a962afc99797f197a42e51f5dd532fa8c">   72</a></span>&#160;<a class="code" href="classOVR_1_1SensorFusion.html#a962afc99797f197a42e51f5dd532fa8c">SensorFusion::~SensorFusion</a>()</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;{   </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">delete</span>(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a2e5cf55702a25041ce105ebafdf0bfe5">   77</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classOVR_1_1SensorFusion.html#a2e5cf55702a25041ce105ebafdf0bfe5">SensorFusion::AttachToSensor</a>(<a class="code" href="classOVR_1_1SensorDevice.html">SensorDevice</a>* sensor)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>-&gt;<a class="code" href="classOVR_1_1MessageHandler.html#a80b91de327dc246da0918c06f6561466">RemoveHandlerFromDevices</a>();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a87b974dd00d2eb452930a0363760a01e">Reset</a>();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (sensor != <a class="code" href="OVR__Linux__HMDDevice_8cpp.html">NULL</a>)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// cache mag calibration state</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ae055070c2c47496c7187db50d076325e">MagCalibrated</a> = sensor-&gt;<a class="code" href="classOVR_1_1SensorDevice.html#ac89d27965bed1b8adad90c91a47e9c28">IsMagCalibrated</a>();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment">// Load IMU position</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="classOVR_1_1Array.html">Array&lt;PositionCalibrationReport&gt;</a> reports;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordtype">bool</span> result = sensor-&gt;<a class="code" href="classOVR_1_1SensorDevice.html#ab181fbadc06baa51e7a79ac98ab28e89">GetAllPositionCalibrationReports</a>(&amp;reports);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> (result)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <a class="code" href="structOVR_1_1PositionCalibrationReport.html">PositionCalibrationReport</a> imu = reports[reports.<a class="code" href="classOVR_1_1ArrayBase.html#aaca24173e69b99485bc409b7a0dd86ae">GetSize</a>() - 1];</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a>(imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#afc98911421eb17dff94c19ddad83eea5">PositionType</a> == <a class="code" href="structOVR_1_1PositionCalibrationReport.html#a3c4a6d6f83d38b9248fdd32a33e6f7a0aee3b845d037bddf27275838078572647">PositionCalibrationReport::PositionType_IMU</a>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="comment">// convert from vision to the world frame</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="comment">// TBD convert rotation as necessary?</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#a439388fe79552b6d2a907ece45f2e710">Position</a>.<a class="code" href="classOVR_1_1Vector3.html#ab43db723b9477d0a7d05bde2145829d8">x</a> *= -1.0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#a439388fe79552b6d2a907ece45f2e710">Position</a>.<a class="code" href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">z</a> *= -1.0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a31c19cde8c54c26a43133a081b636459">ImuFromScreen</a> = <a class="code" href="namespaceOVR.html#a68a88999b443a66a52c47c075b84fa98">Transformd</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#a814d7f3a96ed0e0c1cd0972f3a6f4a3e">Normal</a>, imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#ab71a95755e9f74847fe67dee7cb67e87">Angle</a>), imu.<a class="code" href="structOVR_1_1PositionCalibrationReport.html#a439388fe79552b6d2a907ece45f2e710">Position</a>).<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a6cc55fd17d92d5ec380043236b1c1b96">RecordLedPositions</a>(reports);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a1879b839fca784f20fb49c3b6f5cf085">RecordDeviceIfcVersion</a>(sensor-&gt;<a class="code" href="classOVR_1_1SensorDevice.html#ad0d51fb3a81606efaa31f3f46e72c8e8">GetDeviceInterfaceVersion</a>());</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">// Repopulate CPFOrigin</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#aa5b7177d2cc44d6bfd5e141eb8b5cb79">SetCenterPupilDepth</a>(<a class="code" href="classOVR_1_1SensorFusion.html#aec678e51ccb103d828bc79c8dc59023a">CenterPupilDepth</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">// Subscribe to sensor updates</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        sensor-&gt;<a class="code" href="classOVR_1_1DeviceBase.html#a62b09dddd0dd47eda68928cb4442b7a8">AddMessageHandler</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">// Initialize the sensor state</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">// TBD: This is a hack to avoid a race condition if sensor status is checked immediately </span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">// after sensor creation but before any data has flowed through.  We should probably</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">// not depend strictly on data flow to determine capabilities like orientation and position</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">// tracking, or else use some sort of synchronous method to wait for data</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html">LocklessState</a> init;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        init.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">StatusFlags</a> = <a class="code" href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a1227c77b5df7b9964b69fe89b3386fe1">Status_OrientationTracked</a>;   </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.SetState(init);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;}</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">// Resets the current orientation</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a87b974dd00d2eb452930a0363760a01e">  125</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a87b974dd00d2eb452930a0363760a01e">SensorFusion::Reset</a>()</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classOVR_1_1Lock_1_1Locker.html">Lock::Locker</a> lockScope(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>-&gt;<a class="code" href="classOVR_1_1MessageHandler.html#abee0d64b00880ac2f71e1d1ecbdbf0e7">GetHandlerLock</a>());</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.SetState(<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html">LocklessState</a>());</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>                        = <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>                   = <a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>(); <span class="comment">// place CPF at the origin, not the IMU</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>                       = <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>                         = <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>                     = <a class="code" href="namespaceOVR.html#a01fd8ceb7792c15a7870c1982ec009b4">DefaultWorldFromCamera</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#af3a14122b4273181f15944d3cec435d6">WorldFromCameraConfidence</a>           = -1;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.Clear();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>                  = <a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html">ExposureRecord</a>();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a53e554e06e7ab11ce6c1ee278a64c77c">LastMessageExposureFrame</a>            = <a class="code" href="classOVR_1_1MessageExposureFrame.html">MessageExposureFrame</a>(<a class="code" href="OVR__Linux__HMDDevice_8cpp.html">NULL</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a9cf34c3732114fe2877caea5da3dba97">LastVisionAbsoluteTime</a>              = 0;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#adb9922a212d1ff0f8551648d18331fb0">Stage</a>                               = 0;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>.Clear();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>                           = -1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a12d5cf6f5da7539d8083e5884f3cf7bc">MagCorrectionIntegralTerm</a>           = <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#abf5f176885b366e72094a75b360666d9">AccelOffset</a>                         = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBase.html#aae6dc7915bc5b34f11e25041cd3f941b">Clear</a>();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBase.html#aae6dc7915bc5b34f11e25041cd3f941b">Clear</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#aa3c64b5c2a6d080fe7d16fab922f663c">FAngV</a>.<a class="code" href="classOVR_1_1SensorFilterBase.html#aae6dc7915bc5b34f11e25041cd3f941b">Clear</a>();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">setNeckPivotFromPose</a> ( <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> );</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">//  Vision &amp; message processing</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a06d9b9e48a9191e791563eed848d3adb">  158</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a06d9b9e48a9191e791563eed848d3adb">SensorFusion::OnVisionFailure</a>()</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// do nothing</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a96a8d81a118780a49b948934c6184f39">RecordVisionSuccess</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ab704d73e1497a8e78d80d4f664345a41">  164</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#ab704d73e1497a8e78d80d4f664345a41">SensorFusion::OnVisionPreviousFrame</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a>&amp; cameraFromImu)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// simply save the observation for use in the next OnVisionSuccess call;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// this should not have unintended side-effects for position filtering, </span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// since the vision time is not updated and the system keeps thinking we don&#39;t have vision yet</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> = cameraFromImu;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a8feaefe8cbf9210090c88204127db527">  172</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a8feaefe8cbf9210090c88204127db527">SensorFusion::OnVisionSuccess</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a>&amp; cameraFromImu, <a class="code" href="namespaceOVR.html#a7aadc20df581a4cbab381bc916deaaa4">UInt32</a> exposureCounter)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="classOVR_1_1Lock_1_1Locker.html">Lock::Locker</a> lockScope(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>-&gt;<a class="code" href="classOVR_1_1MessageHandler.html#abee0d64b00880ac2f71e1d1ecbdbf0e7">GetHandlerLock</a>());</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a96a8d81a118780a49b948934c6184f39">RecordVisionSuccess</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a9cf34c3732114fe2877caea5da3dba97">LastVisionAbsoluteTime</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a824ab65e488709381cd5ee9bf4d79d9f">GetTime</a>();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// ********* LastVisionExposureRecord *********</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Skip old data and use the record that matches the exposure counter</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.IsEmpty() &amp;&amp;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;           (<a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PeekFront().ExposureCounter &lt;= exposureCounter))</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PopFront();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// Use current values if we don&#39;t have historical data</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// Right now, this will happen if we get first frame after prediction failure,</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// and this exposure wasn&#39;t in the buffer.  (TBD: Unlikely.. unless IMU message wasn&#39;t sent?)</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#ae82dfb63305b698d68067b20c9eb355d">ExposureCounter</a> != exposureCounter)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a> = <a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html">ExposureRecord</a>(exposureCounter, <a class="code" href="classOVR_1_1SensorFusion.html#a824ab65e488709381cd5ee9bf4d79d9f">GetTime</a>(), <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>, <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>());</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// ********* CameraFromImu *********</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// This is stored in the camera frame, so need to be careful when combining with the IMU data,</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// which is in the world frame</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transformd</a> cameraFromImuPrev = <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> = cameraFromImu; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a7afd24ee1d3b28bc80951b85e3a5ac4b">ExposureTime</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Check LastVisionExposureRecord.Delta.TimeInSeconds to avoid divide by zero, which we could (rarely)</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// get if we didn&#39;t have exposures delta for history (skipped exposure counters</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// due to video mode change that stalls USB, etc).</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> &gt; 0.001)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> visionVelocityInImuFrame = (cameraFromImu.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> - cameraFromImuPrev.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>) /</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                            <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// Use the accel data to estimate the velocity at the exposure time</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// (as opposed to the average velocity between exposures)</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> imuVelocityInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> -</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> / <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> = visionVelocityInImuFrame + </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>().<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(imuVelocityInWorldFrame);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0,0,0);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a4b3f5b4e1d898d1bdfba8ad7122acce1">  224</a></span>&#160;<a class="code" href="classOVR_1_1PoseState.html">PoseStated</a> <a class="code" href="classOVR_1_1SensorFusion.html#a4b3f5b4e1d898d1bdfba8ad7122acce1">SensorFusion::computeVisionError</a>()</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="classOVR_1_1PoseState.html">PoseStated</a> worldFromImuVision = <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a> * <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Here we need to compute the difference between worldFromImuVision and WorldFromImu.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// However this difference needs to be represented in the World frame, not IMU frame.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Therefore the computation is different from simply worldFromImuVision.Pose * WorldFromImu.Pose.Inverted().</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="classOVR_1_1PoseState.html">PoseStated</a> err;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    err.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> * </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a2c52ef3c61673f722295eab9acbde700">Inverted</a>();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    err.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> = worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> - </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    err.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> = worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> - </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#aa7ff6d83ddd6299dab166ea05392614f">  240</a></span>&#160;<a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a> <a class="code" href="classOVR_1_1SensorFusion.html#aa7ff6d83ddd6299dab166ea05392614f">SensorFusion::GetVisionPrediction</a>(<a class="code" href="namespaceOVR.html#a7aadc20df581a4cbab381bc916deaaa4">UInt32</a> exposureCounter)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="classOVR_1_1Lock_1_1Locker.html">Lock::Locker</a> lockScope(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>-&gt;<a class="code" href="classOVR_1_1MessageHandler.html#abee0d64b00880ac2f71e1d1ecbdbf0e7">GetHandlerLock</a>());</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// Combine the small deltas together</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// Should only be one iteration, unless we are skipping camera frames</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html">ExposureRecord</a> record;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a> delta = <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.IsEmpty() &amp;&amp; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;           (<a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PeekFront().ExposureCounter &lt;= exposureCounter))</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        record = <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PopFront();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        delta.<a class="code" href="classOVR_1_1PoseState.html#a744f95ea40710315f8908e424ac1d255">AdvanceByDelta</a>(record.ImuOnlyDelta);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// Put the combine exposure record back in the history, for use in HandleVisionSuccess(...)</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    record.ImuOnlyDelta = delta;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PushFront(record);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transformd</a> result;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (record.VisionTrackingAvailable)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// if the tracking is working normally, use the change in the main state (SFusion output)</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// to compute the prediction</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        result = <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> *</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>() * record.WorldFromImu.Pose;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="comment">// if we just acquired vision, the main state probably doesn&#39;t have the correct position,</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// so can&#39;t rely on it for prediction</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">// solution: use the accelerometer and vision velocity to propagate the previous sample forward</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment">// (don&#39;t forget to transform IMU to the camera frame)</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        result = <a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            (</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> * delta.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> + <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> * delta.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> +</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>().<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(delta.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            );</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ac03a1db52ef65cb3906afd065438de4a">  285</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#ac03a1db52ef65cb3906afd065438de4a">SensorFusion::handleMessage</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1MessageBodyFrame.html">MessageBodyFrame</a>&amp; msg)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="classOVR_1_1Message.html#a15885b1d997889202b81bdf5c8d4ada1">Type</a> != <a class="code" href="namespaceOVR.html#a3594bb2797fe8bd7e4b498711e8fcadbab0e74c330334dedb9ec089ff96dfe6f9">Message_BodyFrame</a> || !<a class="code" href="classOVR_1_1SensorFusion.html#aee594dacfdbb6b8979c4c68e31fa898f">IsMotionTrackingEnabled</a>())</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// Put the sensor readings into convenient local variables</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> gyro(msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#a19740f428ac12c1fb4b51f703492ba4d">RotationRate</a>); </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> accel(msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#a7a8c15b54ea8d2dadc34a72308743f46">Acceleration</a>); </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> mag(msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#a3389286f7bdd77b20cd876433d831fd8">MagneticField</a>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">double</span> DeltaT = msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#a8a97c51a2d02e7707733dfcdd469e65e">TimeDelta</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// Keep track of time</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> = msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#ac9b83cd080fa080e2eb3584c4f8e3862">AbsoluteTimeSeconds</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// We got an update in the last 60ms and the data is not very old</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">bool</span> visionIsRecent = (<a class="code" href="classOVR_1_1SensorFusion.html#a824ab65e488709381cd5ee9bf4d79d9f">GetTime</a>() - <a class="code" href="classOVR_1_1SensorFusion.html#a9cf34c3732114fe2877caea5da3dba97">LastVisionAbsoluteTime</a> &lt; 0.07) &amp;&amp; (<a class="code" href="classOVR_1_1SensorFusion.html#a1e93112f776fd1e16d523dd013b4039b">GetVisionLatency</a>() &lt; 0.25);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#adb9922a212d1ff0f8551648d18331fb0">Stage</a>++;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Insert current sensor data into filter history</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#aa3c64b5c2a6d080fe7d16fab922f663c">FAngV</a>.<a class="code" href="classOVR_1_1SensorFilterBase.html#aa20569b4bf8655426df713374c5ffbcb">PushBack</a>(gyro);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#a3c8ec7a6dae95d27018b60b109d79ab5">Update</a>(accel, DeltaT, <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(gyro, gyro.<a class="code" href="classOVR_1_1Vector3.html#a6dd740b87bfedbd44b02523d1ebc2a83">Length</a>() * DeltaT));</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// Process raw inputs</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// in the future the gravity offset can be calibrated using vision feedback</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> accelInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(accel) - <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0, 9.8, 0);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// Recompute the vision error to account for all the corrections and the new data</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a4b3f5b4e1d898d1bdfba8ad7122acce1">computeVisionError</a>();</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// Update headset orientation   </span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a1cc88fe52bb795815a05b446f53ec837">StoreAndIntegrateGyro</a>(gyro, DeltaT);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// Tilt correction based on accelerometer</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a9ff68e3e14e4301d5104172d588d2424">EnableGravity</a>)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a35571f310f4e5fa0f8b16bba72673e53">applyTiltCorrection</a>(DeltaT);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// Yaw correction based on camera</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a80cb575e8d80955da681da2535cd2640">EnableYawCorrection</a> &amp;&amp; visionIsRecent)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a4949971964f48e7f3f4c505d4619d3f9">applyVisionYawCorrection</a>(DeltaT);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// Yaw correction based on magnetometer</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a80cb575e8d80955da681da2535cd2640">EnableYawCorrection</a> &amp;&amp; <a class="code" href="classOVR_1_1SensorFusion.html#ae055070c2c47496c7187db50d076325e">MagCalibrated</a>) <span class="comment">// MagCalibrated is always false for DK2 for now</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a9970cf92ca96b07ff572a1ca96e3e3c0">applyMagYawCorrection</a>(mag, DeltaT);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// Focus Correction</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">FocusDirection</a>.<a class="code" href="classOVR_1_1Vector3.html#ab43db723b9477d0a7d05bde2145829d8">x</a> != 0.0f || <a class="code" href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">FocusDirection</a>.<a class="code" href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">z</a> != 0.0f) &amp;&amp; <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a> &lt; <a class="code" href="classOVR_1_1Math_3_01float_01_4.html#a0bc92ae60c8ec848ddb4b6baa824a034">Mathf::Pi</a>)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a8697959853c0cd2a5dcc3503a37dbf4f">applyFocusCorrection</a>(DeltaT);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Update camera orientation</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ad6a461010a650287fd4b347793a8f91f">EnableCameraTiltCorrection</a> &amp;&amp; visionIsRecent)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a14da5a89aab4b2a7f7ff920f81cab54b">applyCameraTiltCorrection</a>(accel, DeltaT);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// The quaternion magnitude may slowly drift due to numerical error,</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// so it is periodically normalized.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classOVR_1_1SensorFusion.html#adb9922a212d1ff0f8551648d18331fb0">Stage</a> &amp; 0xFF) == 0)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a4d364d8f4671741c8e48d976e746d997">Normalize</a>();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a4d364d8f4671741c8e48d976e746d997">Normalize</a>();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// Update headset position</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ad5968819d2d0d28cd4d5e33f27ce5dec">VisionPositionEnabled</a> &amp;&amp; visionIsRecent)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment">// Integrate UMI and velocity here up to a fixed amount of time after vision. </span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a64ed6dde83c342cd621cec5b14dc1e86">StoreAndIntegrateAccelerometer</a>(accelInWorldFrame + <a class="code" href="classOVR_1_1SensorFusion.html#abf5f176885b366e72094a75b360666d9">AccelOffset</a>, DeltaT);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="comment">// Position correction based on camera</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#aa886328365f59bb16d819a81edd10799">applyPositionCorrection</a>(DeltaT); </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="comment">// Compute where the neck pivot would be.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">setNeckPivotFromPose</a>(<a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// Fall back onto internal head model</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">// Use the last-known neck pivot position to figure out the expected IMU position.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">// (should be the opposite of SensorFusion::setNeckPivotFromPose)</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a06376af740353d7195171c2ef959e4e4">WorldFromNeck</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a06376af740353d7195171c2ef959e4e4">WorldFromNeck</a> * (<a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a> * <a class="code" href="classOVR_1_1SensorFusion.html#a38372f12b1a9e5c471387b22dc53e1b3">CpfFromNeck</a>).Inverted();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment">// We can&#39;t trust velocity past this point.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0,0,0);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a0ac32680d9b3cf8fb7262b8317d0289b">LinearAcceleration</a> = accelInWorldFrame;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Compute the angular acceleration</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#adae34a1ebb1908541033c0d0b5564ca7">AngularAcceleration</a> = (<a class="code" href="classOVR_1_1SensorFusion.html#aa3c64b5c2a6d080fe7d16fab922f663c">FAngV</a>.<a class="code" href="classOVR_1_1Deque.html#a2fc10bc956e55f3671fe02f1c38cf3a5">GetSize</a>() &gt;= 12 &amp;&amp; DeltaT &gt; 0) ? </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        (<a class="code" href="classOVR_1_1SensorFusion.html#aa3c64b5c2a6d080fe7d16fab922f663c">FAngV</a>.<a class="code" href="classOVR_1_1SensorFilterBase.html#a25ccf6c613bd40e0d61de54c2e155f2f">SavitzkyGolayDerivative12</a>() / DeltaT) : <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>();</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// Update the dead reckoning state used for incremental vision tracking</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#a1cc88fe52bb795815a05b446f53ec837">StoreAndIntegrateGyro</a>(gyro, DeltaT);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#a64ed6dde83c342cd621cec5b14dc1e86">StoreAndIntegrateAccelerometer</a>(accelInWorldFrame, DeltaT);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> - <a class="code" href="classOVR_1_1SensorFusion.html#a53e554e06e7ab11ce6c1ee278a64c77c">LastMessageExposureFrame</a>.<a class="code" href="classOVR_1_1MessageExposureFrame.html#aad802a6495f3723619a3bb7d843a0fe3">CameraTimeSeconds</a>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#ae13f0b12cfa12e5e9dd903e73ee3424a">VisionTrackingAvailable</a> &amp;= (<a class="code" href="classOVR_1_1SensorFusion.html#ad5968819d2d0d28cd4d5e33f27ce5dec">VisionPositionEnabled</a> &amp;&amp; visionIsRecent);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a077cb498b9313c2fdb6a07b5cafdabcf">LogData</a>(<span class="stringliteral">&quot;sfTimeSeconds&quot;</span>, <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a077cb498b9313c2fdb6a07b5cafdabcf">LogData</a>(<span class="stringliteral">&quot;sfStage&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classOVR_1_1SensorFusion.html#adb9922a212d1ff0f8551648d18331fb0">Stage</a>);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a077cb498b9313c2fdb6a07b5cafdabcf">LogData</a>(<span class="stringliteral">&quot;sfPose&quot;</span>, <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">//Recorder::LogData(&quot;sfAngAcc&quot;, State.AngularAcceleration);</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">//Recorder::LogData(&quot;sfAngVel&quot;, State.AngularVelocity);</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">//Recorder::LogData(&quot;sfLinAcc&quot;, State.LinearAcceleration);</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">//Recorder::LogData(&quot;sfLinVel&quot;, State.LinearVelocity);</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// Store the lockless state.    </span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html">LocklessState</a> lstate;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">StatusFlags</a>       = <a class="code" href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a1227c77b5df7b9964b69fe89b3386fe1">Status_OrientationTracked</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ad5968819d2d0d28cd4d5e33f27ce5dec">VisionPositionEnabled</a>)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">StatusFlags</a>  |= <a class="code" href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17ad55500781e3ad0f3f49ae5bd8c17ae0f">Status_PositionConnected</a>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ad5968819d2d0d28cd4d5e33f27ce5dec">VisionPositionEnabled</a> &amp;&amp; visionIsRecent)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">StatusFlags</a>  |= <a class="code" href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a7a2d1ce6f0d156eab79e277ca88f1243">Status_PositionTracked</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">//A convenient means to temporarily extract this flag</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#a52715cbc385352dc231c7a4fc6093352">TPH_IsPositionTracked</a> = visionIsRecent;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">State</a>        = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a6203ad71c1e5504d6e3fb0f920daed45">Temperature</a>  = msg.<a class="code" href="classOVR_1_1MessageBodyFrame.html#a3b45f29f8b6628d14e702df215555a66">Temperature</a>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a32a28b83934fb52029f7cf8dff4e4a5c">Magnetometer</a> = mag;    </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.SetState(lstate);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a10c51d11e2cb35dd7fced2e3da8dcb6d">  398</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a10c51d11e2cb35dd7fced2e3da8dcb6d">SensorFusion::handleExposure</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1MessageExposureFrame.html">MessageExposureFrame</a>&amp; msg)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#ae82dfb63305b698d68067b20c9eb355d">ExposureCounter</a> = msg.<a class="code" href="classOVR_1_1MessageExposureFrame.html#ac71425fecc45a30a33c0e37ac666f647">CameraFrameCount</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a7afd24ee1d3b28bc80951b85e3a5ac4b">ExposureTime</a> = msg.<a class="code" href="classOVR_1_1MessageExposureFrame.html#aad802a6495f3723619a3bb7d843a0fe3">CameraTimeSeconds</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a> = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> = msg.<a class="code" href="classOVR_1_1MessageExposureFrame.html#aad802a6495f3723619a3bb7d843a0fe3">CameraTimeSeconds</a> - <a class="code" href="classOVR_1_1SensorFusion.html#a53e554e06e7ab11ce6c1ee278a64c77c">LastMessageExposureFrame</a>.<a class="code" href="classOVR_1_1MessageExposureFrame.html#aad802a6495f3723619a3bb7d843a0fe3">CameraTimeSeconds</a>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PushBack(<a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// Every new exposure starts from zero</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a> = <a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html">ExposureRecord</a>(); </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a53e554e06e7ab11ce6c1ee278a64c77c">LastMessageExposureFrame</a> = msg;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;}</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">// If you have a known-good pose, this sets the neck pivot position.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">  412</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">SensorFusion::setNeckPivotFromPose</a>(<a class="code" href="classOVR_1_1Transform.html">Transformd</a> <span class="keyword">const</span> &amp;worldFromImu)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a06376af740353d7195171c2ef959e4e4">WorldFromNeck</a> = worldFromImu * <a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a> * <a class="code" href="classOVR_1_1SensorFusion.html#a38372f12b1a9e5c471387b22dc53e1b3">CpfFromNeck</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">// These two functions need to be moved into Quat class</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">// Compute a rotation required to transform &quot;from&quot; into &quot;to&quot;. </span></div>
<div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">  419</a></span>&#160;<a class="code" href="classOVR_1_1Quat.html">Quatd</a> <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> &amp;from, <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> &amp;to)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> axis = from.<a class="code" href="classOVR_1_1Vector3.html#a91b9da9c57824acf33365cb4548933ba">Cross</a>(to);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span> (axis.<a class="code" href="classOVR_1_1Vector3.html#a824723950c8cf90c94f48827858c89ef">LengthSq</a>() == 0)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="comment">// this handles both collinear and zero-length input cases</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">double</span> angle = from.<a class="code" href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">Angle</a>(to);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(axis, angle);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">// Compute the part of the quaternion that rotates around Y axis</span></div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="namespaceOVR.html#a752dd3da2601e6ed4ae3dfd4ec15f14d">  430</a></span>&#160;<a class="code" href="classOVR_1_1Quat.html">Quatd</a> <a class="code" href="namespaceOVR.html#a752dd3da2601e6ed4ae3dfd4ec15f14d">extractYawRotation</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Quat.html">Quatd</a> &amp;error)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;{</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span> (error.<a class="code" href="classOVR_1_1Quat.html#a952058dc6770e67d43e43c82e8ce8e6c">y</a> == 0)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">double</span> phi = atan2(error.<a class="code" href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">w</a>, error.<a class="code" href="classOVR_1_1Quat.html#a952058dc6770e67d43e43c82e8ce8e6c">y</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordtype">double</span> alpha = <a class="code" href="classOVR_1_1Math_3_01double_01_4.html#adb66e1642605aaf551836d6d494853af">Mathd::Pi</a> - 2 * phi;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(<a class="code" href="namespaceOVR.html#a8cd031546237788fad1af5b3c5bb0150ad6a6faac14baa14fe9b1a90b928beae7">Axis_Y</a>, alpha);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#aa886328365f59bb16d819a81edd10799">  439</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#aa886328365f59bb16d819a81edd10799">SensorFusion::applyPositionCorrection</a>(<span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// Each component of gainPos is equivalent to a Kalman gain of (sigma_process / sigma_observation)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> gainPos = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(10, 10, 8);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> gainVel = gainPos.<a class="code" href="classOVR_1_1Vector3.html#a2e5d9ed37b04cd83011f9f7c635d63b0">EntrywiseMultiply</a>(gainPos) * 0.5;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> gainAccel = gainVel * 0.5;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> snapThreshold = 0.1; <span class="comment">// Large value (previously 0.01, which caused frequent jumping)</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> correctionPos, correctionVel;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>.<a class="code" href="classOVR_1_1Vector3.html#a824723950c8cf90c94f48827858c89ef">LengthSq</a>() &gt; (snapThreshold * snapThreshold) ||</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        !(<a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.GetState().StatusFlags &amp; <a class="code" href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a7a2d1ce6f0d156eab79e277ca88f1243">Status_PositionTracked</a>))</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// high error or just reacquired position from vision - apply full correction</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">// to know where we are right now, take the vision pose (which is slightly old)</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">// and update it using the imu data since then</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="classOVR_1_1PoseState.html">PoseStated</a> worldFromImuVision = <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a> * <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.GetSize(); i++)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a744f95ea40710315f8908e424ac1d255">AdvanceByDelta</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PeekFront(i).ImuOnlyDelta);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a744f95ea40710315f8908e424ac1d255">AdvanceByDelta</a>(<a class="code" href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">NextExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">ImuOnlyDelta</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        correctionPos = worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> - <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        correctionVel = worldFromImuVision.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> - <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#abf5f176885b366e72094a75b360666d9">AccelOffset</a>   = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>();</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        correctionPos = <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>.<a class="code" href="classOVR_1_1Vector3.html#a2e5d9ed37b04cd83011f9f7c635d63b0">EntrywiseMultiply</a>(gainPos) * deltaT;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        correctionVel = <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>.<a class="code" href="classOVR_1_1Vector3.html#a2e5d9ed37b04cd83011f9f7c635d63b0">EntrywiseMultiply</a>(gainVel) * deltaT;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#abf5f176885b366e72094a75b360666d9">AccelOffset</a>  += <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>.<a class="code" href="classOVR_1_1Vector3.html#a2e5d9ed37b04cd83011f9f7c635d63b0">EntrywiseMultiply</a>(gainAccel) * deltaT;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> += correctionPos;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> += correctionVel;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// Update the exposure records so that we don&#39;t apply the same correction twice</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> += correctionPos;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> += correctionVel;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.GetSize(); i++)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="classOVR_1_1PoseState.html">PoseStated</a>&amp; state = <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PeekBack(i).WorldFromImu;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        state.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> += correctionPos;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        state.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> += correctionVel;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a4949971964f48e7f3f4c505d4619d3f9">  485</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a4949971964f48e7f3f4c505d4619d3f9">SensorFusion::applyVisionYawCorrection</a>(<span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;{</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> gain = 0.25;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> snapThreshold = 0.1;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> yawError = <a class="code" href="namespaceOVR.html#a752dd3da2601e6ed4ae3dfd4ec15f14d">extractYawRotation</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> correction;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceOVR_1_1Alg.html#a9a3c93262ebbe6e60d3e7f7594925df8">Alg::Abs</a>(yawError.<a class="code" href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">w</a>) &lt; cos(snapThreshold / 2)) <span class="comment">// angle(yawError) &gt; snapThreshold</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">// high error, jump to the vision position</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        correction = yawError;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        correction = yawError.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), gain * deltaT);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// Update the exposure records so that we don&#39;t apply the same correction twice</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * <a class="code" href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">LastVisionExposureRecord</a>.<a class="code" href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.GetSize(); i++)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="classOVR_1_1PoseState.html">PoseStated</a>&amp; state = <a class="code" href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">ExposureRecordHistory</a>.PeekBack(i).WorldFromImu;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        state.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * state.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a9970cf92ca96b07ff572a1ca96e3e3c0">  510</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a9970cf92ca96b07ff572a1ca96e3e3c0">SensorFusion::applyMagYawCorrection</a>(<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> mag, <span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;{</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> minMagLengthSq   = <a class="code" href="classOVR_1_1Math_3_01double_01_4.html#afb6d2ed1c65cce834b37c896104da187">Mathd::Tolerance</a>; <span class="comment">// need to use a real value to discard very weak fields</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> maxMagRefDist    = 0.1;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> maxTiltError     = 0.05;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> proportionalGain = 0.01;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> integralGain     = 0.0005;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> magInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(mag);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// verify that the horizontal component is sufficient</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#ab43db723b9477d0a7d05bde2145829d8">x</a> * magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#ab43db723b9477d0a7d05bde2145829d8">x</a> + magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">z</a> * magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">z</a> &lt; minMagLengthSq)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#a4dea8d4d14c090a1ec77a78b33a95449">Normalize</a>();</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// Delete a bad point</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a> &gt;= 0 &amp;&amp; <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>].Score &lt; 0)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>.RemoveAtUnordered(<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a> = -1;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// Update the reference point if needed</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a> &lt; 0 || mag.<a class="code" href="classOVR_1_1Vector3.html#a089fcfed57492297cc430356540a60b4">Distance</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>].InImuFrame) &gt; maxMagRefDist)</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment">// Find a new one</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        MagRefIdx = -1;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordtype">double</span> bestDist = maxMagRefDist;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>.GetSize(); i++)</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordtype">double</span> dist = mag.<a class="code" href="classOVR_1_1Vector3.html#a089fcfed57492297cc430356540a60b4">Distance</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[i].InImuFrame);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keywordflow">if</span> (bestDist &gt; dist)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                bestDist = dist;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                MagRefIdx = i;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">// Create one if needed</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">if</span> (MagRefIdx &lt; 0 &amp;&amp; <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>.GetSize() &lt; <a class="code" href="classOVR_1_1SensorFusion.html#ac4b5e8161fda5c341961e207dfdfb27ca068987362810f965f08632d2c3224227">MagMaxReferences</a>)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>.PushBack(<a class="code" href="structOVR_1_1SensorFusion_1_1MagReferencePoint.html">MagReferencePoint</a>(mag, <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>, 1000));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (MagRefIdx &gt;= 0)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> magRefInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>].WorldFromImu.Rotate(<a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[MagRefIdx].InImuFrame);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        magRefInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#a4dea8d4d14c090a1ec77a78b33a95449">Normalize</a>();</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">// If the vertical angle is wrong, decrease the score and do nothing</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceOVR_1_1Alg.html#a9a3c93262ebbe6e60d3e7f7594925df8">Alg::Abs</a>(magRefInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a> - magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a>) &gt; maxTiltError)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>].Score -= 1;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">MagRefs</a>[<a class="code" href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">MagRefIdx</a>].Score += 2;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor"></span>        <span class="comment">// this doesn&#39;t seem to work properly, need to investigate</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> error = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(magW, magRefW);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> yawError = <a class="code" href="namespaceOVR.html#a752dd3da2601e6ed4ae3dfd4ec15f14d">extractYawRotation</a>(error);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="preprocessor"></span>        <span class="comment">// Correction is computed in the horizontal plane</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        magInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a> = magRefInWorldFrame.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a> = 0;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> yawError = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(magInWorldFrame, magRefInWorldFrame);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">#endif                                                 </span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor"></span>        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> correction = yawError.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), proportionalGain * deltaT) *</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                           <a class="code" href="classOVR_1_1SensorFusion.html#a12d5cf6f5da7539d8083e5884f3cf7bc">MagCorrectionIntegralTerm</a>.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), deltaT);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a12d5cf6f5da7539d8083e5884f3cf7bc">MagCorrectionIntegralTerm</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a12d5cf6f5da7539d8083e5884f3cf7bc">MagCorrectionIntegralTerm</a> * yawError.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), integralGain * deltaT);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a35571f310f4e5fa0f8b16bba72673e53">  584</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a35571f310f4e5fa0f8b16bba72673e53">SensorFusion::applyTiltCorrection</a>(<span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;{</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> gain = 0.25;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> snapThreshold = 0.1;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> up(0, 1, 0);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> accelInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(<a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#abe850c82a702e2fdd32d729893543736">GetFilteredValue</a>());</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> error = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(accelInWorldFrame, up);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> correction;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1Deque.html#a2fc10bc956e55f3671fe02f1c38cf3a5">GetSize</a>() == 1 || </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        ((<a class="code" href="namespaceOVR_1_1Alg.html#a9a3c93262ebbe6e60d3e7f7594925df8">Alg::Abs</a>(error.<a class="code" href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">w</a>) &lt; cos(snapThreshold / 2) &amp;&amp; <a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#ac26b43e875d85753d07e0c0a010f1efb">Confidence</a>() &gt; 0.75)))</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// full correction for start-up</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">// or large error with high confidence</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        correction = error;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#ac26b43e875d85753d07e0c0a010f1efb">Confidence</a>() &gt; 0.5)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        correction = error.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), gain * deltaT);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// accelerometer is unreliable due to movement</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a14da5a89aab4b2a7f7ff920f81cab54b">  608</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a14da5a89aab4b2a7f7ff920f81cab54b">SensorFusion::applyCameraTiltCorrection</a>(<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> accel, <span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;{</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> snapThreshold = 0.02; <span class="comment">// in radians</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> maxCameraPositionOffset = 0.2;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> up(0, 1, 0), forward(0, 0, -1);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// for startup use filtered value instead of instantaneous for stability</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1CircularBuffer.html#abc6030a538a9dc1dec1e0bf772f3877e">IsEmpty</a>())</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        accel = <a class="code" href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">FAccelInImuFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#abe850c82a702e2fdd32d729893543736">GetFilteredValue</a>();</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transformd</a> cameraFromImu = <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>() * <a class="code" href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">VisionError</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> * <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// this is what the hypothetical camera-mounted accelerometer would show</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> accelInCameraFrame = cameraFromImu.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(accel);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#a3c8ec7a6dae95d27018b60b109d79ab5">Update</a>(accelInCameraFrame, deltaT);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> cameraAccelInWorldFrame = <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#abe850c82a702e2fdd32d729893543736">GetFilteredValue</a>());</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> error1 = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(cameraAccelInWorldFrame, up);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">// cancel out yaw rotation</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> forwardCamera = (error1 * <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>).Rotate(forward);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    forwardCamera.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a> = 0;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> error2 = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(forwardCamera, forward);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// combined error</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> error = error2 * error1;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">double</span> confidence = <a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1SensorFilterBodyFrame.html#ac26b43e875d85753d07e0c0a010f1efb">Confidence</a>();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">// penalize the confidence if looking away from the camera</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// TODO: smooth fall-off</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(forward).<a class="code" href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">Angle</a>(forward) &gt; 1)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        confidence *= 0.5;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">//Convenient global variable to temporarily extract this data.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#ab42b7452dd5114e43091c1772dd46039">TPH_CameraPoseConfidence</a> = confidence;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">//Allow override of confidence threshold</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordtype">double</span> confidenceThreshold = 0.75f;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="OVR__SensorFusion_8cpp.html#aa48eb9e8675069b80c3ba358eaeaa69b">TPH_CameraPoseConfidenceThresholdOverrideIfNonZero</a>)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        confidenceThreshold = <a class="code" href="OVR__SensorFusion_8cpp.html#aa48eb9e8675069b80c3ba358eaeaa69b">TPH_CameraPoseConfidenceThresholdOverrideIfNonZero</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="classOVR_1_1Quat.html">Quatd</a> correction;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">FAccelInCameraFrame</a>.<a class="code" href="classOVR_1_1Deque.html#a2fc10bc956e55f3671fe02f1c38cf3a5">GetSize</a>() == 1 ||</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        confidence &gt; <a class="code" href="classOVR_1_1SensorFusion.html#af3a14122b4273181f15944d3cec435d6">WorldFromCameraConfidence</a> + 0.2 ||</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment">// disabled due to false positives when moving side to side</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">//        (Alg::Abs(error.w) &lt; cos(5 * snapThreshold / 2) &amp;&amp; confidence &gt; 0.55) ||    </span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        (<a class="code" href="namespaceOVR_1_1Alg.html#a9a3c93262ebbe6e60d3e7f7594925df8">Alg::Abs</a>(error.<a class="code" href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">w</a>) &lt; cos(snapThreshold / 2) &amp;&amp; confidence &gt; confidenceThreshold))</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">// large error with high confidence</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        correction = error;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="comment">// update the confidence level</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#af3a14122b4273181f15944d3cec435d6">WorldFromCameraConfidence</a> = confidence;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">// accelerometer is unreliable due to movement</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transformd</a> newWorldFromCamera(correction * <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>, <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a>());</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="comment">// compute a camera position change that together with the camera rotation would result in zero player movement</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    newWorldFromCamera.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> += (<a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a> * <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>).Translation -</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        (newWorldFromCamera * <a class="code" href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">CameraFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>).Translation;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">// if the new position is too far, reset to default </span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="comment">// (can&#39;t hide the rotation, might as well use it to reset the position)</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">if</span> (newWorldFromCamera.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>.<a class="code" href="classOVR_1_1Vector3.html#a8c60652509bd519551dd05ed2298e425">DistanceSq</a>(DefaultWorldFromCamera.Translation) &gt; maxCameraPositionOffset * maxCameraPositionOffset)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        newWorldFromCamera.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> = DefaultWorldFromCamera.Translation;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a> = newWorldFromCamera;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">//Convenient global variable to temporarily extract this data.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a>[0] = (<span class="keywordtype">float</span>) <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">w</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a>[1] = (float) <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#ace2e00d5d57be7708ba67e5038960aa9">x</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a>[2] = (<span class="keywordtype">float</span>) <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a952058dc6770e67d43e43c82e8ce8e6c">y</a>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a>[3] = (float) <a class="code" href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">WorldFromCamera</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>.<a class="code" href="classOVR_1_1Quat.html#a109f0385658aa41592fe4157c3fe71ba">z</a>;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;}</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a8697959853c0cd2a5dcc3503a37dbf4f">  684</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a8697959853c0cd2a5dcc3503a37dbf4f">SensorFusion::applyFocusCorrection</a>(<span class="keywordtype">double</span> deltaT)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> up = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0, 1, 0);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordtype">double</span> gain = 0.01;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> currentDir = <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(<a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0, 0, 1));</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> focusYawComponent = <a class="code" href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">FocusDirection</a>.<a class="code" href="classOVR_1_1Vector3.html#ab97c60770a807db081fe0db56c1cf18b">ProjectToPlane</a>(up);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> currentYawComponent = currentDir.<a class="code" href="classOVR_1_1Vector3.html#ab97c60770a807db081fe0db56c1cf18b">ProjectToPlane</a>(up);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">double</span> angle = focusYawComponent.<a class="code" href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">Angle</a>(currentYawComponent);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span>( angle &gt; <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a> )</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> yawError;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a> != 0.0f)</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> lFocus = <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(up, -<a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a>).<a class="code" href="classOVR_1_1Quat.html#a389102a25cfbcebc3de725ea59c1988d">Rotate</a>(focusYawComponent);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> rFocus = <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(up, <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a>).<a class="code" href="classOVR_1_1Quat.html#a389102a25cfbcebc3de725ea59c1988d">Rotate</a>(focusYawComponent);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordtype">double</span> lAngle = lFocus.<a class="code" href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">Angle</a>(currentYawComponent);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="keywordtype">double</span> rAngle = rFocus.<a class="code" href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">Angle</a>(currentYawComponent);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="keywordflow">if</span>(lAngle &lt; rAngle)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                yawError = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(currentDir, lFocus);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            } </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                yawError = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(currentDir, rFocus);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        } </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            yawError = <a class="code" href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">vectorAlignmentRotation</a>(currentYawComponent, focusYawComponent);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <a class="code" href="classOVR_1_1Quat.html">Quatd</a> correction = yawError.<a class="code" href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">Nlerp</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), gain * deltaT);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = correction * <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">//------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">// Focus filter setting functions</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a699bffaf0b8a092abd1f581bb855d839">  726</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a699bffaf0b8a092abd1f581bb855d839">SensorFusion::SetFocusDirection</a>()</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;{</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a699bffaf0b8a092abd1f581bb855d839">SetFocusDirection</a>(<a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>.<a class="code" href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">Rotate</a>(<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a>(0.0, 0.0, 1.0)));</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;}</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#abaea2f58e70cd307a323cc0040131e19">  731</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a699bffaf0b8a092abd1f581bb855d839">SensorFusion::SetFocusDirection</a>(<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> direction)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;{</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">FocusDirection</a> = direction;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ae04b3f1d2f4de5ad4ed7b6f030f5c221">  736</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#ae04b3f1d2f4de5ad4ed7b6f030f5c221">SensorFusion::SetFocusFOV</a>(<span class="keywordtype">double</span> fov)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;{</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a>(fov &gt;= 0.0);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a> = fov;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;}</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a9b6dccd5983b973dcd32c491bd323e84">  742</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a9b6dccd5983b973dcd32c491bd323e84">SensorFusion::ClearFocus</a>()</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">FocusDirection</a> = <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0.0, 0.0, 0.0);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">FocusFOV</a> = 0.0f;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">// Head model functions.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">// Sets up head-and-neck model and device-to-pupil dimensions from the user&#39;s profile.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ad903217fb6bfc85029a2738b2fc42b6e">  752</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#ad903217fb6bfc85029a2738b2fc42b6e">SensorFusion::SetUserHeadDimensions</a>(<a class="code" href="classOVR_1_1Profile.html">Profile</a> <span class="keyword">const</span> &amp;profile, <a class="code" href="structOVR_1_1HmdRenderInfo.html">HmdRenderInfo</a> <span class="keyword">const</span> &amp;hmdRenderInfo)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordtype">float</span> neckeye[2];</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordtype">int</span> count = profile.<a class="code" href="classOVR_1_1Profile.html#ac47479b24cfa517d23c66e2aea5feb11">GetFloatValues</a>(<a class="code" href="OVR__Profile_8h.html#a02becf302120a1568c16ca8979dfd2ea">OVR_KEY_NECK_TO_EYE_DISTANCE</a>, neckeye, 2);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// Make sure these are vaguely sensible values.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">if</span> (count == 2)</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a> ( ( neckeye[0] &gt; 0.05f ) &amp;&amp; ( neckeye[0] &lt; 0.5f ) );</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a> ( ( neckeye[1] &gt; 0.05f ) &amp;&amp; ( neckeye[1] &lt; 0.5f ) );</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a2625ff5b498c2879cffa436b7355f58e">SetHeadModel</a> ( <a class="code" href="classOVR_1_1Vector3.html">Vector3f</a> ( 0.0, neckeye[1], -neckeye[0] ) );</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// Find the distance from the center of the screen to the &quot;center eye&quot;</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// This center eye is used by systems like rendering &amp; audio to represent the player,</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// and they will handle the offsets needed from there to each actual eye.</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// HACK HACK HACK</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// We know for DK1 the screen-&gt;lens surface distance is roughly 0.049f, and that the faceplate-&gt;lens is 0.02357f.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="comment">// We&#39;re going to assume(!!!!) that all HMDs have the same screen-&gt;faceplate distance.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">// Crystal Cove was measured to be roughly 0.025 screen-&gt;faceplate which agrees with this assumption.</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">// TODO: do this properly!  Update:  Measured this at 0.02733 with a CC prototype, CES era (PT7), on 2/19/14 -Steve</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordtype">float</span> screenCenterToMidplate = 0.02733f;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordtype">float</span> centerEyeRelief = hmdRenderInfo.<a class="code" href="structOVR_1_1HmdRenderInfo.html#a3157ab3ef8124c4995d62cac64d473aa">GetEyeCenter</a>().<a class="code" href="structOVR_1_1HmdRenderInfo.html#af5936f6234b0bf96404ffb8c493dff12">ReliefInMeters</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordtype">float</span> centerPupilDepth = screenCenterToMidplate + hmdRenderInfo.<a class="code" href="structOVR_1_1HmdRenderInfo.html#aec061eb981df56a5c5cd53297fabeb3a">LensSurfaceToMidplateInMeters</a> + centerEyeRelief;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#aa5b7177d2cc44d6bfd5e141eb8b5cb79">SetCenterPupilDepth</a> ( centerPupilDepth );</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#a3984a0c289603f9a7752c01767bf90ca">RecordUserParams</a>(<a class="code" href="classOVR_1_1SensorFusion.html#a44727ca80fc6226feaf60ee07b7aef85">GetHeadModel</a>(), <a class="code" href="classOVR_1_1SensorFusion.html#a7a830cf7910cebe01fb281464678b008">GetCenterPupilDepth</a>());</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;}</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a44727ca80fc6226feaf60ee07b7aef85">  781</a></span>&#160;<a class="code" href="classOVR_1_1Vector3.html">Vector3f</a> <a class="code" href="classOVR_1_1SensorFusion.html#a44727ca80fc6226feaf60ee07b7aef85">SensorFusion::GetHeadModel</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classOVR_1_1Vector3.html">Vector3f</a>)<a class="code" href="classOVR_1_1SensorFusion.html#a38372f12b1a9e5c471387b22dc53e1b3">CpfFromNeck</a>.<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>().<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;}</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a2625ff5b498c2879cffa436b7355f58e">  786</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a2625ff5b498c2879cffa436b7355f58e">SensorFusion::SetHeadModel</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Vector3.html">Vector3f</a> &amp;headModel, <span class="keywordtype">bool</span> resetNeckPivot <span class="comment">/*= true*/</span> )</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;{</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="classOVR_1_1Lock_1_1Locker.html">Lock::Locker</a> lockScope(<a class="code" href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">pHandler</a>-&gt;<a class="code" href="classOVR_1_1MessageHandler.html#abee0d64b00880ac2f71e1d1ecbdbf0e7">GetHandlerLock</a>());</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// The head model should look something like (0, 0.12, -0.12), so</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// these asserts are to try to prevent sign problems, as</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// they can be subtle but nauseating!</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a> ( headModel.<a class="code" href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">y</a> &gt; 0.0f );</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a> ( headModel.<a class="code" href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">z</a> &lt; 0.0f );</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a38372f12b1a9e5c471387b22dc53e1b3">CpfFromNeck</a> = <a class="code" href="namespaceOVR.html#a68a88999b443a66a52c47c075b84fa98">Transformd</a>(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), (<a class="code" href="classOVR_1_1Vector3.html">Vector3d</a>)headModel).<a class="code" href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">Inverted</a>();</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">if</span> ( resetNeckPivot )</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">setNeckPivotFromPose</a> ( <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> );</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a7a830cf7910cebe01fb281464678b008">  801</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classOVR_1_1SensorFusion.html#a7a830cf7910cebe01fb281464678b008">SensorFusion::GetCenterPupilDepth</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classOVR_1_1SensorFusion.html#aec678e51ccb103d828bc79c8dc59023a">CenterPupilDepth</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#aa5b7177d2cc44d6bfd5e141eb8b5cb79">  806</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#aa5b7177d2cc44d6bfd5e141eb8b5cb79">SensorFusion::SetCenterPupilDepth</a>(<span class="keywordtype">float</span> centerPupilDepth)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;{</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#aec678e51ccb103d828bc79c8dc59023a">CenterPupilDepth</a> = centerPupilDepth;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transformd</a> screenFromCpf(<a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(), <a class="code" href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">Vector3d</a>(0, 0, centerPupilDepth));</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a> = <a class="code" href="classOVR_1_1SensorFusion.html#a31c19cde8c54c26a43133a081b636459">ImuFromScreen</a> * screenFromCpf;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">setNeckPivotFromPose</a> ( <a class="code" href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">WorldFromImu</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> );</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;}</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">// This is a &quot;perceptually tuned predictive filter&quot;, which means that it is optimized</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">// for improvements in the VR experience, rather than pure error.  In particular,</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">// jitter is more perceptible at lower speeds whereas latency is more perceptible</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">// after a high-speed motion.  Therefore, the prediction interval is dynamically</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">// adjusted based on speed.  Significant more research is needed to further improve</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">// this family of filters.</span></div>
<div class="line"><a name="l00824"></a><span class="lineno"><a class="line" href="namespaceOVR.html#ab37c2d3dbbf77a23deacae41d2620063">  824</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a> <a class="code" href="namespaceOVR.html#ab37c2d3dbbf77a23deacae41d2620063">calcPredictedPose</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1PoseState.html">PoseState&lt;double&gt;</a>&amp; poseState, <span class="keywordtype">double</span> predictionDt)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;{</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <a class="code" href="classOVR_1_1Transform.html">Transform&lt;double&gt;</a> pose   = poseState.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> linearCoef  = 1.0;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="classOVR_1_1Vector3.html">Vector3d</a> angularVelocity = poseState.<a class="code" href="classOVR_1_1PoseState.html#a7b018d576dada1b19a2a1ae307a4ecac">AngularVelocity</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordtype">double</span>   angularSpeed    = angularVelocity.<a class="code" href="classOVR_1_1Vector3.html#a6dd740b87bfedbd44b02523d1ebc2a83">Length</a>();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// This could be tuned so that linear and angular are combined with different coefficients</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordtype">double</span> speed             = angularSpeed + linearCoef * poseState.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a>.<a class="code" href="classOVR_1_1Vector3.html#a6dd740b87bfedbd44b02523d1ebc2a83">Length</a>();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> slope       = 0.2; <span class="comment">// The rate at which the dynamic prediction interval varies</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordtype">double</span> candidateDt       = slope * speed; <span class="comment">// TODO: Replace with smoothstep function</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordtype">double</span> dynamicDt         = predictionDt;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// Choose the candidate if it is shorter, to improve stability</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span> (candidateDt &lt; predictionDt)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        dynamicDt = candidateDt;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">if</span> (angularSpeed &gt; 0.001)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        pose.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> = pose.<a class="code" href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">Rotation</a> * <a class="code" href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">Quatd</a>(angularVelocity, angularSpeed * dynamicDt);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    pose.<a class="code" href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">Translation</a> += poseState.<a class="code" href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">LinearVelocity</a> * dynamicDt;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">return</span> pose;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a5de1e0de2a988f6dfb429e4299ca5d99">  852</a></span>&#160;<a class="code" href="classOVR_1_1Transform.html">Transformf</a> <a class="code" href="classOVR_1_1SensorFusion.html#a5de1e0de2a988f6dfb429e4299ca5d99">SensorFusion::GetPoseAtTime</a>(<span class="keywordtype">double</span> absoluteTime)<span class="keyword"> const</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="classOVR_1_1SensorState.html">SensorState</a> ss = <a class="code" href="classOVR_1_1SensorFusion.html#ab10b8929b111afa177e2abf54bc77222">GetSensorStateAtTime</a> ( absoluteTime );</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">return</span> ss.<a class="code" href="classOVR_1_1SensorState.html#a6211febc465c836c4c29ab592e5cbaf9">Predicted</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;}</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ab10b8929b111afa177e2abf54bc77222">  859</a></span>&#160;<a class="code" href="classOVR_1_1SensorState.html">SensorState</a> <a class="code" href="classOVR_1_1SensorFusion.html#ab10b8929b111afa177e2abf54bc77222">SensorFusion::GetSensorStateAtTime</a>(<span class="keywordtype">double</span> absoluteTime)<span class="keyword"> const</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="keyword"></span>{          </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;     <span class="keyword">const</span> <a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html">LocklessState</a> lstate = <a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.GetState();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;     <span class="comment">// Delta time from the last available data</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">double</span> pdt = absoluteTime - lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">State</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;     </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;     <a class="code" href="classOVR_1_1SensorState.html">SensorState</a> ss;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#aef1fad7a0097bec6dca83abe05dbc68f">Recorded</a>     = <a class="code" href="namespaceOVR.html#a2ede2f201f36bea96f1d6ee04affe466">PoseStatef</a>(lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">State</a>);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#a4e5d6738bd9b7c4911b16ac772abd1c0">Temperature</a>  = lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a6203ad71c1e5504d6e3fb0f920daed45">Temperature</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#aebc870565f1b6f6884d7c0dca38825eb">Magnetometer</a> = <a class="code" href="namespaceOVR.html#a69d9da93ca851e0b09c0ed959c14751c">Vector3f</a>(lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a32a28b83934fb52029f7cf8dff4e4a5c">Magnetometer</a>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#a915923c4c8ed3cbbdcd68b2e8351b1e5">StatusFlags</a>  = lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">StatusFlags</a>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#a6211febc465c836c4c29ab592e5cbaf9">Predicted</a>               = ss.<a class="code" href="classOVR_1_1SensorState.html#aef1fad7a0097bec6dca83abe05dbc68f">Recorded</a>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#a6211febc465c836c4c29ab592e5cbaf9">Predicted</a>.<a class="code" href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">TimeInSeconds</a> = absoluteTime;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;     <span class="comment">// Do prediction logic and ImuFromCpf transformation</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#aef1fad7a0097bec6dca83abe05dbc68f">Recorded</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a>  = <a class="code" href="namespaceOVR.html#a418d01381bd7f306742d4264547bdc9c">Transformf</a>(lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">State</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> * <a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a>);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;     ss.<a class="code" href="classOVR_1_1SensorState.html#a6211febc465c836c4c29ab592e5cbaf9">Predicted</a>.<a class="code" href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">Pose</a> = <a class="code" href="namespaceOVR.html#a418d01381bd7f306742d4264547bdc9c">Transformf</a>(<a class="code" href="namespaceOVR.html#ab37c2d3dbbf77a23deacae41d2620063">calcPredictedPose</a>(lstate.<a class="code" href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">State</a>, pdt) * <a class="code" href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">ImuFromCpf</a>);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;     <span class="keywordflow">return</span> ss;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#ae7779b6e0609d9cda10718b64572d34f">  880</a></span>&#160;<span class="keywordtype">unsigned</span> <a class="code" href="classOVR_1_1SensorFusion.html#ae7779b6e0609d9cda10718b64572d34f">SensorFusion::GetStatus</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">UpdatedState</a>.GetState().StatusFlags;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;}</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion.html#a99ca55458a9a53422fde9f5057312bbc">  887</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion.html#a99ca55458a9a53422fde9f5057312bbc">SensorFusion::OnMessage</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1MessageBodyFrame.html">MessageBodyFrame</a>&amp; msg)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a>(!<a class="code" href="classOVR_1_1SensorFusion.html#a6f2182008b38c1f61c9f59a0676f3487">IsAttachedToSensor</a>());</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="classOVR_1_1SensorFusion.html#ac03a1db52ef65cb3906afd065438de4a">handleMessage</a>(msg);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">//-------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a5bf6d593895fb1b35ef0b46bcc282e1a">  895</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a5bf6d593895fb1b35ef0b46bcc282e1a">SensorFusion::BodyFrameHandler::OnMessage</a>(<span class="keyword">const</span> <a class="code" href="classOVR_1_1Message.html">Message</a>&amp; msg)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">Recording::GetRecorder</a>().<a class="code" href="classOVR_1_1Recording_1_1Recorder.html#addf089c8d7ea6412074195a15856830d">RecordMessage</a>(msg);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="classOVR_1_1Message.html#a15885b1d997889202b81bdf5c8d4ada1">Type</a> == <a class="code" href="namespaceOVR.html#a3594bb2797fe8bd7e4b498711e8fcadbab0e74c330334dedb9ec089ff96dfe6f9">Message_BodyFrame</a>)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a30e01d53a2467dccf791b03b3d675ca7">pFusion</a>-&gt;<a class="code" href="classOVR_1_1SensorFusion.html#ac03a1db52ef65cb3906afd065438de4a">handleMessage</a>(static_cast&lt;const MessageBodyFrame&amp;&gt;(msg));</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="classOVR_1_1Message.html#a15885b1d997889202b81bdf5c8d4ada1">Type</a> == <a class="code" href="namespaceOVR.html#a3594bb2797fe8bd7e4b498711e8fcadba25b826cdfd2338dad058171f0318487b">Message_ExposureFrame</a>)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <a class="code" href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a30e01d53a2467dccf791b03b3d675ca7">pFusion</a>-&gt;<a class="code" href="classOVR_1_1SensorFusion.html#a10c51d11e2cb35dd7fced2e3da8dcb6d">handleExposure</a>(static_cast&lt;const MessageExposureFrame&amp;&gt;(msg));</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;} <span class="comment">// namespace OVR</span></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a9b6dccd5983b973dcd32c491bd323e84"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a9b6dccd5983b973dcd32c491bd323e84">OVR::SensorFusion::ClearFocus</a></div><div class="ttdeci">void ClearFocus()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00742">OVR_SensorFusion.cpp:742</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBodyFrame_html_abe850c82a702e2fdd32d729893543736"><div class="ttname"><a href="classOVR_1_1SensorFilterBodyFrame.html#abe850c82a702e2fdd32d729893543736">OVR::SensorFilterBodyFrame::GetFilteredValue</a></div><div class="ttdeci">Vector3d GetFilteredValue() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00299">OVR_SensorFilter.h:299</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ab10b8929b111afa177e2abf54bc77222"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ab10b8929b111afa177e2abf54bc77222">OVR::SensorFusion::GetSensorStateAtTime</a></div><div class="ttdeci">SensorState GetSensorStateAtTime(double absoluteTime) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00859">OVR_SensorFusion.cpp:859</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a2c52ef3c61673f722295eab9acbde700"><div class="ttname"><a href="classOVR_1_1Quat.html#a2c52ef3c61673f722295eab9acbde700">OVR::Quat::Inverted</a></div><div class="ttdeci">Quat Inverted() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00957">OVR_Math.h:957</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ab704d73e1497a8e78d80d4f664345a41"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ab704d73e1497a8e78d80d4f664345a41">OVR::SensorFusion::OnVisionPreviousFrame</a></div><div class="ttdeci">virtual void OnVisionPreviousFrame(const Transform&lt; double &gt; &amp;cameraFromImu)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00164">OVR_SensorFusion.cpp:164</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a7a830cf7910cebe01fb281464678b008"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a7a830cf7910cebe01fb281464678b008">OVR::SensorFusion::GetCenterPupilDepth</a></div><div class="ttdeci">float GetCenterPupilDepth() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00801">OVR_SensorFusion.cpp:801</a></div></div>
<div class="ttc" id="namespaceOVR_html_a58837a8f196de4b8be986a876dc938f5"><div class="ttname"><a href="namespaceOVR.html#a58837a8f196de4b8be986a876dc938f5">OVR::LogText</a></div><div class="ttdeci">void LogText(const char *fmt,...) OVR_LOG_VAARG_ATTRIBUTE(1</div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html_afc98911421eb17dff94c19ddad83eea5"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html#afc98911421eb17dff94c19ddad83eea5">OVR::PositionCalibrationReport::PositionType</a></div><div class="ttdeci">PositionTypeEnum PositionType</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00733">OVR_Device.h:733</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aa5b7177d2cc44d6bfd5e141eb8b5cb79"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aa5b7177d2cc44d6bfd5e141eb8b5cb79">OVR::SensorFusion::SetCenterPupilDepth</a></div><div class="ttdeci">void SetCenterPupilDepth(float centerPupilDepth)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00806">OVR_SensorFusion.cpp:806</a></div></div>
<div class="ttc" id="structOVR_1_1HmdRenderInfo_html_af5936f6234b0bf96404ffb8c493dff12"><div class="ttname"><a href="structOVR_1_1HmdRenderInfo.html#af5936f6234b0bf96404ffb8c493dff12">OVR::HmdRenderInfo::EyeConfig::ReliefInMeters</a></div><div class="ttdeci">float ReliefInMeters</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Stereo_8h_source.html#l00292">OVR_Stereo.h:292</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html_a6211febc465c836c4c29ab592e5cbaf9"><div class="ttname"><a href="classOVR_1_1SensorState.html#a6211febc465c836c4c29ab592e5cbaf9">OVR::SensorState::Predicted</a></div><div class="ttdeci">PoseStatef Predicted</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00145">OVR_SensorFusion.h:145</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a1cc88fe52bb795815a05b446f53ec837"><div class="ttname"><a href="classOVR_1_1PoseState.html#a1cc88fe52bb795815a05b446f53ec837">OVR::PoseState::StoreAndIntegrateGyro</a></div><div class="ttdeci">void StoreAndIntegrateGyro(Vector3d angVel, double dt)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00554">OVR_SensorFusion.h:554</a></div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html_a439388fe79552b6d2a907ece45f2e710"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html#a439388fe79552b6d2a907ece45f2e710">OVR::PositionCalibrationReport::Position</a></div><div class="ttdeci">Vector3d Position</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00724">OVR_Device.h:724</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a9cf34c3732114fe2877caea5da3dba97"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a9cf34c3732114fe2877caea5da3dba97">OVR::SensorFusion::LastVisionAbsoluteTime</a></div><div class="ttdeci">double LastVisionAbsoluteTime</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00408">OVR_SensorFusion.h:408</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1LocklessState_html_a6203ad71c1e5504d6e3fb0f920daed45"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1LocklessState.html#a6203ad71c1e5504d6e3fb0f920daed45">OVR::SensorFusion::LocklessState::Temperature</a></div><div class="ttdeci">float Temperature</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00332">OVR_SensorFusion.h:332</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBodyFrame_html_ac26b43e875d85753d07e0c0a010f1efb"><div class="ttname"><a href="classOVR_1_1SensorFilterBodyFrame.html#ac26b43e875d85753d07e0c0a010f1efb">OVR::SensorFilterBodyFrame::Confidence</a></div><div class="ttdeci">double Confidence() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00271">OVR_SensorFilter.h:271</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a6dd740b87bfedbd44b02523d1ebc2a83"><div class="ttname"><a href="classOVR_1_1Vector3.html#a6dd740b87bfedbd44b02523d1ebc2a83">OVR::Vector3::Length</a></div><div class="ttdeci">T Length() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00509">OVR_Math.h:509</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a9970cf92ca96b07ff572a1ca96e3e3c0"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a9970cf92ca96b07ff572a1ca96e3e3c0">OVR::SensorFusion::applyMagYawCorrection</a></div><div class="ttdeci">void applyMagYawCorrection(Vector3d mag, double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00510">OVR_SensorFusion.cpp:510</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a38372f12b1a9e5c471387b22dc53e1b3"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a38372f12b1a9e5c471387b22dc53e1b3">OVR::SensorFusion::CpfFromNeck</a></div><div class="ttdeci">Transformd CpfFromNeck</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00447">OVR_SensorFusion.h:447</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a91b9da9c57824acf33365cb4548933ba"><div class="ttname"><a href="classOVR_1_1Vector3.html#a91b9da9c57824acf33365cb4548933ba">OVR::Vector3::Cross</a></div><div class="ttdeci">Vector3 Cross(const Vector3 &amp;b) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00492">OVR_Math.h:492</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a9ff68e3e14e4301d5104172d588d2424"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a9ff68e3e14e4301d5104172d588d2424">OVR::SensorFusion::EnableGravity</a></div><div class="ttdeci">bool EnableGravity</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00421">OVR_SensorFusion.h:421</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a4dea8d4d14c090a1ec77a78b33a95449"><div class="ttname"><a href="classOVR_1_1Vector3.html#a4dea8d4d14c090a1ec77a78b33a95449">OVR::Vector3::Normalize</a></div><div class="ttdeci">void Normalize()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00521">OVR_Math.h:521</a></div></div>
<div class="ttc" id="namespaceOVR_html_a3594bb2797fe8bd7e4b498711e8fcadba25b826cdfd2338dad058171f0318487b"><div class="ttname"><a href="namespaceOVR.html#a3594bb2797fe8bd7e4b498711e8fcadba25b826cdfd2338dad058171f0318487b">OVR::Message_ExposureFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00060">OVR_DeviceMessages.h:60</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a1e4da5e76f848dbcf266e8137ad36017"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a1e4da5e76f848dbcf266e8137ad36017">OVR::SensorFusion::UpdatedState</a></div><div class="ttdeci">LocklessUpdater&lt; LocklessState &gt; UpdatedState</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00385">OVR_SensorFusion.h:385</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ac71404d0d23bff073f2d99223d80bc40"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ac71404d0d23bff073f2d99223d80bc40">OVR::SensorFusion::WorldFromImu</a></div><div class="ttdeci">PoseState&lt; double &gt; WorldFromImu</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00381">OVR_SensorFusion.h:381</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html_a2a2265c9952c48ae6f3407cd27201f92"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a2a2265c9952c48ae6f3407cd27201f92">OVR::SensorFusion::ExposureRecord::ImuOnlyDelta</a></div><div class="ttdeci">PoseState&lt; double &gt; ImuOnlyDelta</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00352">OVR_SensorFusion.h:352</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html_aef1fad7a0097bec6dca83abe05dbc68f"><div class="ttname"><a href="classOVR_1_1SensorState.html#aef1fad7a0097bec6dca83abe05dbc68f">OVR::SensorState::Recorded</a></div><div class="ttdeci">PoseStatef Recorded</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00148">OVR_SensorFusion.h:148</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a089fcfed57492297cc430356540a60b4"><div class="ttname"><a href="classOVR_1_1Vector3.html#a089fcfed57492297cc430356540a60b4">OVR::Vector3::Distance</a></div><div class="ttdeci">T Distance(Vector3 const &amp;b) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00515">OVR_Math.h:515</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBase_html_aae6dc7915bc5b34f11e25041cd3f941b"><div class="ttname"><a href="classOVR_1_1SensorFilterBase.html#aae6dc7915bc5b34f11e25041cd3f941b">OVR::SensorFilterBase::Clear</a></div><div class="ttdeci">void Clear()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00094">OVR_SensorFilter.h:94</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_ace2e00d5d57be7708ba67e5038960aa9"><div class="ttname"><a href="classOVR_1_1Quat.html#ace2e00d5d57be7708ba67e5038960aa9">OVR::Quat::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00698">OVR_Math.h:698</a></div></div>
<div class="ttc" id="OVR__Linux__HMDDevice_8cpp_html"><div class="ttname"><a href="OVR__Linux__HMDDevice_8cpp.html">NULL</a></div><div class="ttdeci">#define NULL</div></div>
<div class="ttc" id="OVR__SensorFusion_8cpp_html_aa48eb9e8675069b80c3ba358eaeaa69b"><div class="ttname"><a href="OVR__SensorFusion_8cpp.html#aa48eb9e8675069b80c3ba358eaeaa69b">TPH_CameraPoseConfidenceThresholdOverrideIfNonZero</a></div><div class="ttdeci">double TPH_CameraPoseConfidenceThresholdOverrideIfNonZero</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00041">OVR_SensorFusion.cpp:41</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_a8a97c51a2d02e7707733dfcdd469e65e"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#a8a97c51a2d02e7707733dfcdd469e65e">OVR::MessageBodyFrame::TimeDelta</a></div><div class="ttdeci">float TimeDelta</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00114">OVR_DeviceMessages.h:114</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a46702d98766ab3624c743e6cf9e18cdb"><div class="ttname"><a href="classOVR_1_1Vector3.html#a46702d98766ab3624c743e6cf9e18cdb">OVR::Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00397">OVR_Math.h:397</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_1_1BodyFrameHandler_html"><div class="ttname"><a href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html">OVR::SensorFusion::BodyFrameHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00311">OVR_SensorFusion.h:311</a></div></div>
<div class="ttc" id="classOVR_1_1SensorDevice_html_ad0d51fb3a81606efaa31f3f46e72c8e8"><div class="ttname"><a href="classOVR_1_1SensorDevice.html#ad0d51fb3a81606efaa31f3f46e72c8e8">OVR::SensorDevice::GetDeviceInterfaceVersion</a></div><div class="ttdeci">virtual UByte GetDeviceInterfaceVersion()=0</div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_1_1BodyFrameHandler_html_a5bf6d593895fb1b35ef0b46bcc282e1a"><div class="ttname"><a href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a5bf6d593895fb1b35ef0b46bcc282e1a">OVR::SensorFusion::BodyFrameHandler::OnMessage</a></div><div class="ttdeci">virtual void OnMessage(const Message &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00895">OVR_SensorFusion.cpp:895</a></div></div>
<div class="ttc" id="classOVR_1_1Transform_html"><div class="ttname"><a href="classOVR_1_1Transform.html">OVR::Transform&lt; double &gt;</a></div></div>
<div class="ttc" id="OVR__Profile_8h_html_a02becf302120a1568c16ca8979dfd2ea"><div class="ttname"><a href="OVR__Profile_8h.html#a02becf302120a1568c16ca8979dfd2ea">OVR_KEY_NECK_TO_EYE_DISTANCE</a></div><div class="ttdeci">#define OVR_KEY_NECK_TO_EYE_DISTANCE</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Profile_8h_source.html#l00182">OVR_Profile.h:182</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a2e5cf55702a25041ce105ebafdf0bfe5"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a2e5cf55702a25041ce105ebafdf0bfe5">OVR::SensorFusion::AttachToSensor</a></div><div class="ttdeci">bool AttachToSensor(SensorDevice *sensor)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00077">OVR_SensorFusion.cpp:77</a></div></div>
<div class="ttc" id="classOVR_1_1Math_3_01float_01_4_html_a0bc92ae60c8ec848ddb4b6baa824a034"><div class="ttname"><a href="classOVR_1_1Math_3_01float_01_4.html#a0bc92ae60c8ec848ddb4b6baa824a034">OVR::Math&lt; float &gt;::Pi</a></div><div class="ttdeci">static const float Pi</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00178">OVR_Math.h:178</a></div></div>
<div class="ttc" id="classOVR_1_1SensorDevice_html"><div class="ttname"><a href="classOVR_1_1SensorDevice.html">OVR::SensorDevice</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00964">OVR_Device.h:964</a></div></div>
<div class="ttc" id="structOVR_1_1HmdRenderInfo_html"><div class="ttname"><a href="structOVR_1_1HmdRenderInfo.html">OVR::HmdRenderInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Stereo_8h_source.html#l00257">OVR_Stereo.h:257</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_af3a14122b4273181f15944d3cec435d6"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#af3a14122b4273181f15944d3cec435d6">OVR::SensorFusion::WorldFromCameraConfidence</a></div><div class="ttdeci">double WorldFromCameraConfidence</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00432">OVR_SensorFusion.h:432</a></div></div>
<div class="ttc" id="namespaceOVR_html_a7aadc20df581a4cbab381bc916deaaa4"><div class="ttname"><a href="namespaceOVR.html#a7aadc20df581a4cbab381bc916deaaa4">OVR::UInt32</a></div><div class="ttdeci">uint32_t UInt32</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Types_8h_source.html#l00253">OVR_Types.h:253</a></div></div>
<div class="ttc" id="classOVR_1_1Lock_1_1Locker_html"><div class="ttname"><a href="classOVR_1_1Lock_1_1Locker.html">OVR::Lock::Locker</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Atomic_8h_source.html#l00856">OVR_Atomic.h:856</a></div></div>
<div class="ttc" id="classOVR_1_1MessageExposureFrame_html_aad802a6495f3723619a3bb7d843a0fe3"><div class="ttname"><a href="classOVR_1_1MessageExposureFrame.html#aad802a6495f3723619a3bb7d843a0fe3">OVR::MessageExposureFrame::CameraTimeSeconds</a></div><div class="ttdeci">double CameraTimeSeconds</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00150">OVR_DeviceMessages.h:150</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aa7ff6d83ddd6299dab166ea05392614f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aa7ff6d83ddd6299dab166ea05392614f">OVR::SensorFusion::GetVisionPrediction</a></div><div class="ttdeci">virtual Transform&lt; double &gt; GetVisionPrediction(UInt32 exposureCounter)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00240">OVR_SensorFusion.cpp:240</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_ab97c60770a807db081fe0db56c1cf18b"><div class="ttname"><a href="classOVR_1_1Vector3.html#ab97c60770a807db081fe0db56c1cf18b">OVR::Vector3::ProjectToPlane</a></div><div class="ttdeci">Vector3 ProjectToPlane(const Vector3 &amp;normal) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00550">OVR_Math.h:550</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a2625ff5b498c2879cffa436b7355f58e"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a2625ff5b498c2879cffa436b7355f58e">OVR::SensorFusion::SetHeadModel</a></div><div class="ttdeci">void SetHeadModel(const Vector3f &amp;headModel, bool resetNeckPivot=true)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00786">OVR_SensorFusion.cpp:786</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a744f95ea40710315f8908e424ac1d255"><div class="ttname"><a href="classOVR_1_1PoseState.html#a744f95ea40710315f8908e424ac1d255">OVR::PoseState::AdvanceByDelta</a></div><div class="ttdeci">void AdvanceByDelta(const PoseState&lt; T &gt; &amp;delta)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00573">OVR_SensorFusion.h:573</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_a1879b839fca784f20fb49c3b6f5cf085"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#a1879b839fca784f20fb49c3b6f5cf085">OVR::Recording::Recorder::RecordDeviceIfcVersion</a></div><div class="ttdeci">OVR_FORCE_INLINE void RecordDeviceIfcVersion(UByte)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00066">OVR_Recording.h:66</a></div></div>
<div class="ttc" id="OVR__SensorFusion_8h_html"><div class="ttname"><a href="OVR__SensorFusion_8h.html">OVR_SensorFusion.h</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aec678e51ccb103d828bc79c8dc59023a"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aec678e51ccb103d828bc79c8dc59023a">OVR::SensorFusion::CenterPupilDepth</a></div><div class="ttdeci">float CenterPupilDepth</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00441">OVR_SensorFusion.h:441</a></div></div>
<div class="ttc" id="namespaceOVR_html_ae062159dec251852d3af27fe6e2c2643"><div class="ttname"><a href="namespaceOVR.html#ae062159dec251852d3af27fe6e2c2643">OVR::vectorAlignmentRotation</a></div><div class="ttdeci">Quatd vectorAlignmentRotation(const Vector3d &amp;from, const Vector3d &amp;to)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00419">OVR_SensorFusion.cpp:419</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a06376af740353d7195171c2ef959e4e4"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a06376af740353d7195171c2ef959e4e4">OVR::SensorFusion::WorldFromNeck</a></div><div class="ttdeci">Transformd WorldFromNeck</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00449">OVR_SensorFusion.h:449</a></div></div>
<div class="ttc" id="classOVR_1_1Profile_html"><div class="ttname"><a href="classOVR_1_1Profile.html">OVR::Profile</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Profile_8h_source.html#l00113">OVR_Profile.h:113</a></div></div>
<div class="ttc" id="namespaceOVR_html_ab37c2d3dbbf77a23deacae41d2620063"><div class="ttname"><a href="namespaceOVR.html#ab37c2d3dbbf77a23deacae41d2620063">OVR::calcPredictedPose</a></div><div class="ttdeci">static Transform&lt; double &gt; calcPredictedPose(const PoseState&lt; double &gt; &amp;poseState, double predictionDt)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00824">OVR_SensorFusion.cpp:824</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a2dc0edbc377128dd9e21e5d51de84323"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a2dc0edbc377128dd9e21e5d51de84323">OVR::SensorFusion::FocusFOV</a></div><div class="ttdeci">double FocusFOV</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00414">OVR_SensorFusion.h:414</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_a3b45f29f8b6628d14e702df215555a66"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#a3b45f29f8b6628d14e702df215555a66">OVR::MessageBodyFrame::Temperature</a></div><div class="ttdeci">float Temperature</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00113">OVR_DeviceMessages.h:113</a></div></div>
<div class="ttc" id="namespaceOVR_html_a01fd8ceb7792c15a7870c1982ec009b4"><div class="ttname"><a href="namespaceOVR.html#a01fd8ceb7792c15a7870c1982ec009b4">OVR::DefaultWorldFromCamera</a></div><div class="ttdeci">const Transformd DefaultWorldFromCamera(Quatd(), Vector3d(0, 0,-1))</div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a35571f310f4e5fa0f8b16bba72673e53"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a35571f310f4e5fa0f8b16bba72673e53">OVR::SensorFusion::applyTiltCorrection</a></div><div class="ttdeci">void applyTiltCorrection(double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00584">OVR_SensorFusion.cpp:584</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a4d364d8f4671741c8e48d976e746d997"><div class="ttname"><a href="classOVR_1_1Quat.html#a4d364d8f4671741c8e48d976e746d997">OVR::Quat::Normalize</a></div><div class="ttdeci">void Normalize()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00908">OVR_Math.h:908</a></div></div>
<div class="ttc" id="namespaceOVR_html_a752dd3da2601e6ed4ae3dfd4ec15f14d"><div class="ttname"><a href="namespaceOVR.html#a752dd3da2601e6ed4ae3dfd4ec15f14d">OVR::extractYawRotation</a></div><div class="ttdeci">Quatd extractYawRotation(const Quatd &amp;error)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00430">OVR_SensorFusion.cpp:430</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a389102a25cfbcebc3de725ea59c1988d"><div class="ttname"><a href="classOVR_1_1Quat.html#a389102a25cfbcebc3de725ea59c1988d">OVR::Quat::Rotate</a></div><div class="ttdeci">Vector3&lt; T &gt; Rotate(const Vector3&lt; T &gt; &amp;v) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00951">OVR_Math.h:951</a></div></div>
<div class="ttc" id="OVR__Profile_8h_html"><div class="ttname"><a href="OVR__Profile_8h.html">OVR_Profile.h</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_a7a8c15b54ea8d2dadc34a72308743f46"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#a7a8c15b54ea8d2dadc34a72308743f46">OVR::MessageBodyFrame::Acceleration</a></div><div class="ttdeci">Vector3f Acceleration</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00110">OVR_DeviceMessages.h:110</a></div></div>
<div class="ttc" id="classOVR_1_1CircularBuffer_html_abc6030a538a9dc1dec1e0bf772f3877e"><div class="ttname"><a href="classOVR_1_1CircularBuffer.html#abc6030a538a9dc1dec1e0bf772f3877e">OVR::CircularBuffer::IsEmpty</a></div><div class="ttdeci">bool IsEmpty() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__ThreadCommandQueue_8cpp_source.html#l00069">OVR_ThreadCommandQueue.cpp:69</a></div></div>
<div class="ttc" id="namespaceOVR_html_a68a88999b443a66a52c47c075b84fa98"><div class="ttname"><a href="namespaceOVR.html#a68a88999b443a66a52c47c075b84fa98">OVR::Transformd</a></div><div class="ttdeci">Transform&lt; double &gt; Transformd</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01160">OVR_Math.h:1160</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBodyFrame_html_a3c8ec7a6dae95d27018b60b109d79ab5"><div class="ttname"><a href="classOVR_1_1SensorFilterBodyFrame.html#a3c8ec7a6dae95d27018b60b109d79ab5">OVR::SensorFilterBodyFrame::Update</a></div><div class="ttdeci">void Update(Vector3d value, double deltaT, Quatd deltaQ=Quatd())</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00279">OVR_SensorFilter.h:279</a></div></div>
<div class="ttc" id="classOVR_1_1SensorDevice_html_ac89d27965bed1b8adad90c91a47e9c28"><div class="ttname"><a href="classOVR_1_1SensorDevice.html#ac89d27965bed1b8adad90c91a47e9c28">OVR::SensorDevice::IsMagCalibrated</a></div><div class="ttdeci">virtual bool IsMagCalibrated()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l01022">OVR_Device.h:1022</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html_ae82dfb63305b698d68067b20c9eb355d"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#ae82dfb63305b698d68067b20c9eb355d">OVR::SensorFusion::ExposureRecord::ExposureCounter</a></div><div class="ttdeci">UInt32 ExposureCounter</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00347">OVR_SensorFusion.h:347</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_adae34a1ebb1908541033c0d0b5564ca7"><div class="ttname"><a href="classOVR_1_1PoseState.html#adae34a1ebb1908541033c0d0b5564ca7">OVR::PoseState::AngularAcceleration</a></div><div class="ttdeci">Vector3&lt; T &gt; AngularAcceleration</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00095">OVR_SensorFusion.h:95</a></div></div>
<div class="ttc" id="classOVR_1_1Array_html"><div class="ttname"><a href="classOVR_1_1Array.html">OVR::Array</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Array_8h_source.html#l00747">OVR_Array.h:747</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html_a915923c4c8ed3cbbdcd68b2e8351b1e5"><div class="ttname"><a href="classOVR_1_1SensorState.html#a915923c4c8ed3cbbdcd68b2e8351b1e5">OVR::SensorState::StatusFlags</a></div><div class="ttdeci">unsigned int StatusFlags</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00155">OVR_SensorFusion.h:155</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ac03a1db52ef65cb3906afd065438de4a"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ac03a1db52ef65cb3906afd065438de4a">OVR::SensorFusion::handleMessage</a></div><div class="ttdeci">void handleMessage(const MessageBodyFrame &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00285">OVR_SensorFusion.cpp:285</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a699bffaf0b8a092abd1f581bb855d839"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a699bffaf0b8a092abd1f581bb855d839">OVR::SensorFusion::SetFocusDirection</a></div><div class="ttdeci">void SetFocusDirection()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00726">OVR_SensorFusion.cpp:726</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html_ae13f0b12cfa12e5e9dd903e73ee3424a"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#ae13f0b12cfa12e5e9dd903e73ee3424a">OVR::SensorFusion::ExposureRecord::VisionTrackingAvailable</a></div><div class="ttdeci">bool VisionTrackingAvailable</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00354">OVR_SensorFusion.h:354</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aa886328365f59bb16d819a81edd10799"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aa886328365f59bb16d819a81edd10799">OVR::SensorFusion::applyPositionCorrection</a></div><div class="ttdeci">void applyPositionCorrection(double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00439">OVR_SensorFusion.cpp:439</a></div></div>
<div class="ttc" id="classOVR_1_1SensorDevice_html_ab181fbadc06baa51e7a79ac98ab28e89"><div class="ttname"><a href="classOVR_1_1SensorDevice.html#ab181fbadc06baa51e7a79ac98ab28e89">OVR::SensorDevice::GetAllPositionCalibrationReports</a></div><div class="ttdeci">virtual bool GetAllPositionCalibrationReports(Array&lt; PositionCalibrationReport &gt; *)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l01039">OVR_Device.h:1039</a></div></div>
<div class="ttc" id="classOVR_1_1Message_html_a15885b1d997889202b81bdf5c8d4ada1"><div class="ttname"><a href="classOVR_1_1Message.html#a15885b1d997889202b81bdf5c8d4ada1">OVR::Message::Type</a></div><div class="ttdeci">MessageType Type</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00082">OVR_DeviceMessages.h:82</a></div></div>
<div class="ttc" id="classOVR_1_1Math_3_01double_01_4_html_adb66e1642605aaf551836d6d494853af"><div class="ttname"><a href="classOVR_1_1Math_3_01double_01_4.html#adb66e1642605aaf551836d6d494853af">OVR::Math&lt; double &gt;::Pi</a></div><div class="ttdeci">static const double Pi</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00202">OVR_Math.h:202</a></div></div>
<div class="ttc" id="namespaceOVR_html_a418d01381bd7f306742d4264547bdc9c"><div class="ttname"><a href="namespaceOVR.html#a418d01381bd7f306742d4264547bdc9c">OVR::Transformf</a></div><div class="ttdeci">Transform&lt; float &gt; Transformf</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01159">OVR_Math.h:1159</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ad5968819d2d0d28cd4d5e33f27ce5dec"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ad5968819d2d0d28cd4d5e33f27ce5dec">OVR::SensorFusion::VisionPositionEnabled</a></div><div class="ttdeci">bool VisionPositionEnabled</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00435">OVR_SensorFusion.h:435</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a8c60652509bd519551dd05ed2298e425"><div class="ttname"><a href="classOVR_1_1Vector3.html#a8c60652509bd519551dd05ed2298e425">OVR::Vector3::DistanceSq</a></div><div class="ttdeci">T DistanceSq(Vector3 const &amp;b) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00512">OVR_Math.h:512</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a12d5cf6f5da7539d8083e5884f3cf7bc"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a12d5cf6f5da7539d8083e5884f3cf7bc">OVR::SensorFusion::MagCorrectionIntegralTerm</a></div><div class="ttdeci">Quatd MagCorrectionIntegralTerm</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00427">OVR_SensorFusion.h:427</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_a077cb498b9313c2fdb6a07b5cafdabcf"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#a077cb498b9313c2fdb6a07b5cafdabcf">OVR::Recording::Recorder::LogData</a></div><div class="ttdeci">OVR_FORCE_INLINE void LogData(const char *, const T &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00070">OVR_Recording.h:70</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a6720a47fdda19467a682d5a6d3b13cfe"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a6720a47fdda19467a682d5a6d3b13cfe">OVR::SensorFusion::FAccelInCameraFrame</a></div><div class="ttdeci">SensorFilterBodyFrame FAccelInCameraFrame</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00416">OVR_SensorFusion.h:416</a></div></div>
<div class="ttc" id="classOVR_1_1Transform_html_a2d70b43886235610e0b9926576b83aa1"><div class="ttname"><a href="classOVR_1_1Transform.html#a2d70b43886235610e0b9926576b83aa1">OVR::Transform::Inverted</a></div><div class="ttdeci">Transform Inverted() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01152">OVR_Math.h:1152</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1LocklessState_html"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1LocklessState.html">OVR::SensorFusion::LocklessState</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00329">OVR_SensorFusion.h:329</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a8feaefe8cbf9210090c88204127db527"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a8feaefe8cbf9210090c88204127db527">OVR::SensorFusion::OnVisionSuccess</a></div><div class="ttdeci">virtual void OnVisionSuccess(const Transform&lt; double &gt; &amp;cameraFromImu, UInt32 exposureCounter)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00172">OVR_SensorFusion.cpp:172</a></div></div>
<div class="ttc" id="classOVR_1_1MessageExposureFrame_html"><div class="ttname"><a href="classOVR_1_1MessageExposureFrame.html">OVR::MessageExposureFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00141">OVR_DeviceMessages.h:141</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a0a48f10e4ff2a383eb41fe547e884127"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a0a48f10e4ff2a383eb41fe547e884127">OVR::SensorFusion::pHandler</a></div><div class="ttdeci">BodyFrameHandler * pHandler</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00411">OVR_SensorFusion.h:411</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a31c19cde8c54c26a43133a081b636459"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a31c19cde8c54c26a43133a081b636459">OVR::SensorFusion::ImuFromScreen</a></div><div class="ttdeci">Transformd ImuFromScreen</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00445">OVR_SensorFusion.h:445</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_adb9922a212d1ff0f8551648d18331fb0"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#adb9922a212d1ff0f8551648d18331fb0">OVR::SensorFusion::Stage</a></div><div class="ttdeci">unsigned int Stage</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00410">OVR_SensorFusion.h:410</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a5de1e0de2a988f6dfb429e4299ca5d99"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a5de1e0de2a988f6dfb429e4299ca5d99">OVR::SensorFusion::GetPoseAtTime</a></div><div class="ttdeci">Transformf GetPoseAtTime(double absoluteTime) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00852">OVR_SensorFusion.cpp:852</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1LocklessState_html_a32a28b83934fb52029f7cf8dff4e4a5c"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1LocklessState.html#a32a28b83934fb52029f7cf8dff4e4a5c">OVR::SensorFusion::LocklessState::Magnetometer</a></div><div class="ttdeci">Vector3d Magnetometer</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00333">OVR_SensorFusion.h:333</a></div></div>
<div class="ttc" id="namespaceOVR_html_a588962a0a9cf64665579ad21cbc5ef9a"><div class="ttname"><a href="namespaceOVR.html#a588962a0a9cf64665579ad21cbc5ef9a">OVR::Quatd</a></div><div class="ttdeci">Quat&lt; double &gt; Quatd</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01086">OVR_Math.h:1086</a></div></div>
<div class="ttc" id="classOVR_1_1ArrayBase_html_aaca24173e69b99485bc409b7a0dd86ae"><div class="ttname"><a href="classOVR_1_1ArrayBase.html#aaca24173e69b99485bc409b7a0dd86ae">OVR::ArrayBase&lt; ArrayData&lt; T, ContainerAllocator&lt; T &gt;, SizePolicy &gt; &gt;::GetSize</a></div><div class="ttdeci">UPInt GetSize() const</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Array_8h_source.html#l00376">OVR_Array.h:376</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_addf089c8d7ea6412074195a15856830d"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#addf089c8d7ea6412074195a15856830d">OVR::Recording::Recorder::RecordMessage</a></div><div class="ttdeci">OVR_FORCE_INLINE void RecordMessage(const Message &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00067">OVR_Recording.h:67</a></div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html_a3c4a6d6f83d38b9248fdd32a33e6f7a0aee3b845d037bddf27275838078572647"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html#a3c4a6d6f83d38b9248fdd32a33e6f7a0aee3b845d037bddf27275838078572647">OVR::PositionCalibrationReport::PositionType_IMU</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00699">OVR_Device.h:699</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html">OVR::SensorFusion::ExposureRecord</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00345">OVR_SensorFusion.h:345</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a6bdd6f633513703ba4998aa4610dd159"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a6bdd6f633513703ba4998aa4610dd159">OVR::SensorFusion::MagRefs</a></div><div class="ttdeci">Array&lt; MagReferencePoint &gt; MagRefs</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00425">OVR_SensorFusion.h:425</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBase_html_a25ccf6c613bd40e0d61de54c2e155f2f"><div class="ttname"><a href="classOVR_1_1SensorFilterBase.html#a25ccf6c613bd40e0d61de54c2e155f2f">OVR::SensorFilterBase::SavitzkyGolayDerivative12</a></div><div class="ttdeci">T SavitzkyGolayDerivative12() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00164">OVR_SensorFilter.h:164</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_a3984a0c289603f9a7752c01767bf90ca"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#a3984a0c289603f9a7752c01767bf90ca">OVR::Recording::Recorder::RecordUserParams</a></div><div class="ttdeci">OVR_FORCE_INLINE void RecordUserParams(const Vector3f &amp;, float)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00065">OVR_Recording.h:65</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a7b018d576dada1b19a2a1ae307a4ecac"><div class="ttname"><a href="classOVR_1_1PoseState.html#a7b018d576dada1b19a2a1ae307a4ecac">OVR::PoseState::AngularVelocity</a></div><div class="ttdeci">Vector3&lt; T &gt; AngularVelocity</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00093">OVR_SensorFusion.h:93</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a80cb575e8d80955da681da2535cd2640"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a80cb575e8d80955da681da2535cd2640">OVR::SensorFusion::EnableYawCorrection</a></div><div class="ttdeci">bool EnableYawCorrection</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00423">OVR_SensorFusion.h:423</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a99ca55458a9a53422fde9f5057312bbc"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a99ca55458a9a53422fde9f5057312bbc">OVR::SensorFusion::OnMessage</a></div><div class="ttdeci">void OnMessage(const MessageBodyFrame &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00887">OVR_SensorFusion.cpp:887</a></div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html">OVR::PositionCalibrationReport</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00694">OVR_Device.h:694</a></div></div>
<div class="ttc" id="namespaceOVR_html_a19f8ba309f1129bd04d6ba0b187098a8"><div class="ttname"><a href="namespaceOVR.html#a19f8ba309f1129bd04d6ba0b187098a8">OVR::Vector3d</a></div><div class="ttdeci">Vector3&lt; double &gt; Vector3d</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00555">OVR_Math.h:555</a></div></div>
<div class="ttc" id="OVR__Types_8h_html_a6a9ec62c6637d7f63797bf61015c78ff"><div class="ttname"><a href="OVR__Types_8h.html#a6a9ec62c6637d7f63797bf61015c78ff">OVR_ASSERT</a></div><div class="ttdeci">#define OVR_ASSERT(p)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Linux__HMDDevice_8cpp_source.html#l00381">OVR_Linux_HMDDevice.cpp:381</a></div></div>
<div class="ttc" id="namespaceOVR_html_a50ee0d376336370e6b3f558de5bf5f17a7a2d1ce6f0d156eab79e277ca88f1243"><div class="ttname"><a href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a7a2d1ce6f0d156eab79e277ca88f1243">OVR::Status_PositionTracked</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00128">OVR_SensorFusion.h:128</a></div></div>
<div class="ttc" id="OVR__SensorFusion_8cpp_html_ab42b7452dd5114e43091c1772dd46039"><div class="ttname"><a href="OVR__SensorFusion_8cpp.html#ab42b7452dd5114e43091c1772dd46039">TPH_CameraPoseConfidence</a></div><div class="ttdeci">double TPH_CameraPoseConfidence</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00040">OVR_SensorFusion.cpp:40</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a44727ca80fc6226feaf60ee07b7aef85"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a44727ca80fc6226feaf60ee07b7aef85">OVR::SensorFusion::GetHeadModel</a></div><div class="ttdeci">Vector3f GetHeadModel() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00781">OVR_SensorFusion.cpp:781</a></div></div>
<div class="ttc" id="classOVR_1_1Deque_html_a2fc10bc956e55f3671fe02f1c38cf3a5"><div class="ttname"><a href="classOVR_1_1Deque.html#a2fc10bc956e55f3671fe02f1c38cf3a5">OVR::Deque::GetSize</a></div><div class="ttdeci">virtual UPInt GetSize(void) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Deque_8h_source.html#l00259">OVR_Deque.h:259</a></div></div>
<div class="ttc" id="classOVR_1_1Message_html"><div class="ttname"><a href="classOVR_1_1Message.html">OVR::Message</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00075">OVR_DeviceMessages.h:75</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a962afc99797f197a42e51f5dd532fa8c"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a962afc99797f197a42e51f5dd532fa8c">OVR::SensorFusion::~SensorFusion</a></div><div class="ttdeci">~SensorFusion()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00072">OVR_SensorFusion.cpp:72</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_acb24e8da42b57d54759c8c546285082c"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#acb24e8da42b57d54759c8c546285082c">OVR::SensorFusion::SensorFusion</a></div><div class="ttdeci">SensorFusion(SensorDevice *sensor=0)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00052">OVR_SensorFusion.cpp:52</a></div></div>
<div class="ttc" id="OVR__JSON_8h_html"><div class="ttname"><a href="OVR__JSON_8h.html">OVR_JSON.h</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a6e19e8c96bf79b6c3ff2b63b211d0940"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a6e19e8c96bf79b6c3ff2b63b211d0940">OVR::SensorFusion::CameraFromImu</a></div><div class="ttdeci">PoseState&lt; double &gt; CameraFromImu</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00388">OVR_SensorFusion.h:388</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ae04b3f1d2f4de5ad4ed7b6f030f5c221"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ae04b3f1d2f4de5ad4ed7b6f030f5c221">OVR::SensorFusion::SetFocusFOV</a></div><div class="ttdeci">void SetFocusFOV(double rads)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00736">OVR_SensorFusion.cpp:736</a></div></div>
<div class="ttc" id="OVR__System_8h_html"><div class="ttname"><a href="OVR__System_8h.html">OVR_System.h</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a4a60d4170f184f45b387e7141aad1ec4"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a4a60d4170f184f45b387e7141aad1ec4">OVR::SensorFusion::FocusDirection</a></div><div class="ttdeci">Vector3d FocusDirection</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00413">OVR_SensorFusion.h:413</a></div></div>
<div class="ttc" id="classOVR_1_1Profile_html_ac47479b24cfa517d23c66e2aea5feb11"><div class="ttname"><a href="classOVR_1_1Profile.html#ac47479b24cfa517d23c66e2aea5feb11">OVR::Profile::GetFloatValues</a></div><div class="ttdeci">int GetFloatValues(const char *key, float *values, int num_vals) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Profile_8cpp_source.html#l01275">OVR_Profile.cpp:1275</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a2b3239efaadffeb4fb3bf282cf69ca33"><div class="ttname"><a href="classOVR_1_1Quat.html#a2b3239efaadffeb4fb3bf282cf69ca33">OVR::Quat::w</a></div><div class="ttdeci">T w</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00698">OVR_Math.h:698</a></div></div>
<div class="ttc" id="OVR__Recording_8h_html"><div class="ttname"><a href="OVR__Recording_8h.html">OVR_Recording.h</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1LocklessState_html_ada65c71322c28526ddd769f588f9430a"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1LocklessState.html#ada65c71322c28526ddd769f588f9430a">OVR::SensorFusion::LocklessState::StatusFlags</a></div><div class="ttdeci">unsigned int StatusFlags</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00334">OVR_SensorFusion.h:334</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a33859ebc92f56b52dd7207869a5577da"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a33859ebc92f56b52dd7207869a5577da">OVR::SensorFusion::VisionError</a></div><div class="ttdeci">PoseState&lt; double &gt; VisionError</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00396">OVR_SensorFusion.h:396</a></div></div>
<div class="ttc" id="OVR__SensorFusion_8cpp_html_af2c2cc31e3591882ca6aed1135d31a8b"><div class="ttname"><a href="OVR__SensorFusion_8cpp.html#af2c2cc31e3591882ca6aed1135d31a8b">Global_Flag_1</a></div><div class="ttdeci">bool Global_Flag_1</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00036">OVR_SensorFusion.cpp:36</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a109f0385658aa41592fe4157c3fe71ba"><div class="ttname"><a href="classOVR_1_1Quat.html#a109f0385658aa41592fe4157c3fe71ba">OVR::Quat::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00698">OVR_Math.h:698</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a2e5d9ed37b04cd83011f9f7c635d63b0"><div class="ttname"><a href="classOVR_1_1Vector3.html#a2e5d9ed37b04cd83011f9f7c635d63b0">OVR::Vector3::EntrywiseMultiply</a></div><div class="ttdeci">Vector3 EntrywiseMultiply(const Vector3 &amp;b) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00470">OVR_Math.h:470</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a8697959853c0cd2a5dcc3503a37dbf4f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a8697959853c0cd2a5dcc3503a37dbf4f">OVR::SensorFusion::applyFocusCorrection</a></div><div class="ttdeci">void applyFocusCorrection(double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00684">OVR_SensorFusion.cpp:684</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a1e93112f776fd1e16d523dd013b4039b"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a1e93112f776fd1e16d523dd013b4039b">OVR::SensorFusion::GetVisionLatency</a></div><div class="ttdeci">double GetVisionLatency() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00528">OVR_SensorFusion.h:528</a></div></div>
<div class="ttc" id="classOVR_1_1Math_3_01double_01_4_html_afb6d2ed1c65cce834b37c896104da187"><div class="ttname"><a href="classOVR_1_1Math_3_01double_01_4.html#afb6d2ed1c65cce834b37c896104da187">OVR::Math&lt; double &gt;::Tolerance</a></div><div class="ttdeci">static const double Tolerance</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00214">OVR_Math.h:214</a></div></div>
<div class="ttc" id="classOVR_1_1MessageHandler_html_abee0d64b00880ac2f71e1d1ecbdbf0e7"><div class="ttname"><a href="classOVR_1_1MessageHandler.html#abee0d64b00880ac2f71e1d1ecbdbf0e7">OVR::MessageHandler::GetHandlerLock</a></div><div class="ttdeci">Lock * GetHandlerLock() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceImpl_8cpp_source.html#l00211">OVR_DeviceImpl.cpp:211</a></div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html_a814d7f3a96ed0e0c1cd0972f3a6f4a3e"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html#a814d7f3a96ed0e0c1cd0972f3a6f4a3e">OVR::PositionCalibrationReport::Normal</a></div><div class="ttdeci">Vector3d Normal</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00726">OVR_Device.h:726</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ac4b5e8161fda5c341961e207dfdfb27ca068987362810f965f08632d2c3224227"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ac4b5e8161fda5c341961e207dfdfb27ca068987362810f965f08632d2c3224227">OVR::SensorFusion::MagMaxReferences</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00195">OVR_SensorFusion.h:195</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a4949971964f48e7f3f4c505d4619d3f9"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a4949971964f48e7f3f4c505d4619d3f9">OVR::SensorFusion::applyVisionYawCorrection</a></div><div class="ttdeci">void applyVisionYawCorrection(double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00485">OVR_SensorFusion.cpp:485</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a5bf3310453902c76b1366a8897b76eda"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a5bf3310453902c76b1366a8897b76eda">OVR::SensorFusion::ExposureRecordHistory</a></div><div class="ttdeci">CircularBuffer&lt; ExposureRecord &gt; ExposureRecordHistory</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00399">OVR_SensorFusion.h:399</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_a19740f428ac12c1fb4b51f703492ba4d"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#a19740f428ac12c1fb4b51f703492ba4d">OVR::MessageBodyFrame::RotationRate</a></div><div class="ttdeci">Vector3f RotationRate</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00111">OVR_DeviceMessages.h:111</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ae055070c2c47496c7187db50d076325e"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ae055070c2c47496c7187db50d076325e">OVR::SensorFusion::MagCalibrated</a></div><div class="ttdeci">bool MagCalibrated</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00424">OVR_SensorFusion.h:424</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a10c51d11e2cb35dd7fced2e3da8dcb6d"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a10c51d11e2cb35dd7fced2e3da8dcb6d">OVR::SensorFusion::handleExposure</a></div><div class="ttdeci">void handleExposure(const MessageExposureFrame &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00398">OVR_SensorFusion.cpp:398</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aa3c64b5c2a6d080fe7d16fab922f663c"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aa3c64b5c2a6d080fe7d16fab922f663c">OVR::SensorFusion::FAngV</a></div><div class="ttdeci">SensorFilterd FAngV</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00417">OVR_SensorFusion.h:417</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html_a4e5d6738bd9b7c4911b16ac772abd1c0"><div class="ttname"><a href="classOVR_1_1SensorState.html#a4e5d6738bd9b7c4911b16ac772abd1c0">OVR::SensorState::Temperature</a></div><div class="ttdeci">float Temperature</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00153">OVR_SensorFusion.h:153</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ac1bd58fee84c13ce059b5ba52aee97f3"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ac1bd58fee84c13ce059b5ba52aee97f3">OVR::SensorFusion::FAccelInImuFrame</a></div><div class="ttdeci">SensorFilterBodyFrame FAccelInImuFrame</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00416">OVR_SensorFusion.h:416</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html"><div class="ttname"><a href="classOVR_1_1PoseState.html">OVR::PoseState&lt; double &gt;</a></div></div>
<div class="ttc" id="classOVR_1_1Transform_html_a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9"><div class="ttname"><a href="classOVR_1_1Transform.html#a1f8a9f5b2a1ee9e51ebd03d6ba5b33a9">OVR::Transform::Translation</a></div><div class="ttdeci">Vector3&lt; T &gt; Translation</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01119">OVR_Math.h:1119</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html_a7afd24ee1d3b28bc80951b85e3a5ac4b"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a7afd24ee1d3b28bc80951b85e3a5ac4b">OVR::SensorFusion::ExposureRecord::ExposureTime</a></div><div class="ttdeci">double ExposureTime</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00348">OVR_SensorFusion.h:348</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a8b58a41429328fb36f55afcf2bcc22d8"><div class="ttname"><a href="classOVR_1_1PoseState.html#a8b58a41429328fb36f55afcf2bcc22d8">OVR::PoseState::LinearVelocity</a></div><div class="ttdeci">Vector3&lt; T &gt; LinearVelocity</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00094">OVR_SensorFusion.h:94</a></div></div>
<div class="ttc" id="OVR__Stereo_8h_html"><div class="ttname"><a href="OVR__Stereo_8h.html">OVR_Stereo.h</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ae7779b6e0609d9cda10718b64572d34f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ae7779b6e0609d9cda10718b64572d34f">OVR::SensorFusion::GetStatus</a></div><div class="ttdeci">unsigned int GetStatus() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00880">OVR_SensorFusion.cpp:880</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html"><div class="ttname"><a href="classOVR_1_1SensorState.html">OVR::SensorState</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00135">OVR_SensorFusion.h:135</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_a96a8d81a118780a49b948934c6184f39"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#a96a8d81a118780a49b948934c6184f39">OVR::Recording::Recorder::RecordVisionSuccess</a></div><div class="ttdeci">OVR_FORCE_INLINE void RecordVisionSuccess(UInt32)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00069">OVR_Recording.h:69</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ad903217fb6bfc85029a2738b2fc42b6e"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ad903217fb6bfc85029a2738b2fc42b6e">OVR::SensorFusion::SetUserHeadDimensions</a></div><div class="ttdeci">void SetUserHeadDimensions(Profile const &amp;profile, HmdRenderInfo const &amp;hmdRenderInfo)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00752">OVR_SensorFusion.cpp:752</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ae1e406e049756b96fc902dcf06fcc059"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ae1e406e049756b96fc902dcf06fcc059">OVR::SensorFusion::NextExposureRecord</a></div><div class="ttdeci">ExposureRecord NextExposureRecord</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00404">OVR_SensorFusion.h:404</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_ad6a461010a650287fd4b347793a8f91f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#ad6a461010a650287fd4b347793a8f91f">OVR::SensorFusion::EnableCameraTiltCorrection</a></div><div class="ttdeci">bool EnableCameraTiltCorrection</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00429">OVR_SensorFusion.h:429</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_afd956cecacb42feadc3436e41fdc762e"><div class="ttname"><a href="classOVR_1_1Vector3.html#afd956cecacb42feadc3436e41fdc762e">OVR::Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00397">OVR_Math.h:397</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a6ca8af4050cf7874e0e23e67ea0b68cf"><div class="ttname"><a href="classOVR_1_1Quat.html#a6ca8af4050cf7874e0e23e67ea0b68cf">OVR::Quat::Nlerp</a></div><div class="ttdeci">Quat Nlerp(const Quat &amp;other, T a)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00943">OVR_Math.h:943</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_addf2e8fd2a7157ae07ae0f6c91548fdd"><div class="ttname"><a href="classOVR_1_1PoseState.html#addf2e8fd2a7157ae07ae0f6c91548fdd">OVR::PoseState::TimeInSeconds</a></div><div class="ttdeci">double TimeInSeconds</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00098">OVR_SensorFusion.h:98</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a824723950c8cf90c94f48827858c89ef"><div class="ttname"><a href="classOVR_1_1Vector3.html#a824723950c8cf90c94f48827858c89ef">OVR::Vector3::LengthSq</a></div><div class="ttdeci">T LengthSq() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00506">OVR_Math.h:506</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_1_1BodyFrameHandler_html_a30e01d53a2467dccf791b03b3d675ca7"><div class="ttname"><a href="classOVR_1_1SensorFusion_1_1BodyFrameHandler.html#a30e01d53a2467dccf791b03b3d675ca7">OVR::SensorFusion::BodyFrameHandler::pFusion</a></div><div class="ttdeci">SensorFusion * pFusion</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00313">OVR_SensorFusion.h:313</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a041e93a68b61e42fd37a63515aec4ec9"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a041e93a68b61e42fd37a63515aec4ec9">OVR::SensorFusion::LastVisionExposureRecord</a></div><div class="ttdeci">ExposureRecord LastVisionExposureRecord</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00401">OVR_SensorFusion.h:401</a></div></div>
<div class="ttc" id="OVR__SensorFusion_8cpp_html_a79b2de47c1d6cd38ac230d88dca8bf1d"><div class="ttname"><a href="OVR__SensorFusion_8cpp.html#a79b2de47c1d6cd38ac230d88dca8bf1d">TPH_CameraPoseOrientationWxyz</a></div><div class="ttdeci">float TPH_CameraPoseOrientationWxyz[4]</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00039">OVR_SensorFusion.cpp:39</a></div></div>
<div class="ttc" id="namespaceOVR_html_a8cd031546237788fad1af5b3c5bb0150ad6a6faac14baa14fe9b1a90b928beae7"><div class="ttname"><a href="namespaceOVR.html#a8cd031546237788fad1af5b3c5bb0150ad6a6faac14baa14fe9b1a90b928beae7">OVR::Axis_Y</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00050">OVR_Math.h:50</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_adb140f62c663ad9ee91bc480c1897cc0"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#adb140f62c663ad9ee91bc480c1897cc0">OVR::SensorFusion::ImuFromCpf</a></div><div class="ttdeci">Transformd ImuFromCpf</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00443">OVR_SensorFusion.h:443</a></div></div>
<div class="ttc" id="namespaceOVR_html_a50ee0d376336370e6b3f558de5bf5f17ad55500781e3ad0f3f49ae5bd8c17ae0f"><div class="ttname"><a href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17ad55500781e3ad0f3f49ae5bd8c17ae0f">OVR::Status_PositionConnected</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00129">OVR_SensorFusion.h:129</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a4b3f5b4e1d898d1bdfba8ad7122acce1"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a4b3f5b4e1d898d1bdfba8ad7122acce1">OVR::SensorFusion::computeVisionError</a></div><div class="ttdeci">PoseStated computeVisionError()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00224">OVR_SensorFusion.cpp:224</a></div></div>
<div class="ttc" id="namespaceOVR_html_a3594bb2797fe8bd7e4b498711e8fcadbab0e74c330334dedb9ec089ff96dfe6f9"><div class="ttname"><a href="namespaceOVR.html#a3594bb2797fe8bd7e4b498711e8fcadbab0e74c330334dedb9ec089ff96dfe6f9">OVR::Message_BodyFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00059">OVR_DeviceMessages.h:59</a></div></div>
<div class="ttc" id="structOVR_1_1HmdRenderInfo_html_aec061eb981df56a5c5cd53297fabeb3a"><div class="ttname"><a href="structOVR_1_1HmdRenderInfo.html#aec061eb981df56a5c5cd53297fabeb3a">OVR::HmdRenderInfo::LensSurfaceToMidplateInMeters</a></div><div class="ttdeci">float LensSurfaceToMidplateInMeters</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Stereo_8h_source.html#l00273">OVR_Stereo.h:273</a></div></div>
<div class="ttc" id="classOVR_1_1Recording_1_1Recorder_html_a6cc55fd17d92d5ec380043236b1c1b96"><div class="ttname"><a href="classOVR_1_1Recording_1_1Recorder.html#a6cc55fd17d92d5ec380043236b1c1b96">OVR::Recording::Recorder::RecordLedPositions</a></div><div class="ttdeci">OVR_FORCE_INLINE void RecordLedPositions(const Array&lt; PositionCalibrationReport &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00064">OVR_Recording.h:64</a></div></div>
<div class="ttc" id="namespaceOVR_html_a2ede2f201f36bea96f1d6ee04affe466"><div class="ttname"><a href="namespaceOVR.html#a2ede2f201f36bea96f1d6ee04affe466">OVR::PoseStatef</a></div><div class="ttdeci">PoseState&lt; float &gt; PoseStatef</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00116">OVR_SensorFusion.h:116</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a64ed6dde83c342cd621cec5b14dc1e86"><div class="ttname"><a href="classOVR_1_1PoseState.html#a64ed6dde83c342cd621cec5b14dc1e86">OVR::PoseState::StoreAndIntegrateAccelerometer</a></div><div class="ttdeci">void StoreAndIntegrateAccelerometer(Vector3d linearAccel, double dt)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00563">OVR_SensorFusion.h:563</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1ExposureRecord_html_a6d7844c6cf998a190743d8324f7ed0d5"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1ExposureRecord.html#a6d7844c6cf998a190743d8324f7ed0d5">OVR::SensorFusion::ExposureRecord::WorldFromImu</a></div><div class="ttdeci">PoseState&lt; double &gt; WorldFromImu</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00350">OVR_SensorFusion.h:350</a></div></div>
<div class="ttc" id="structOVR_1_1HmdRenderInfo_html_a3157ab3ef8124c4995d62cac64d473aa"><div class="ttname"><a href="structOVR_1_1HmdRenderInfo.html#a3157ab3ef8124c4995d62cac64d473aa">OVR::HmdRenderInfo::GetEyeCenter</a></div><div class="ttdeci">EyeConfig GetEyeCenter() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Stereo_8h_source.html#l00327">OVR_Stereo.h:327</a></div></div>
<div class="ttc" id="classOVR_1_1Timer_html_a31feb8884a8d8bb8b7ca76d4e40e8a88"><div class="ttname"><a href="classOVR_1_1Timer.html#a31feb8884a8d8bb8b7ca76d4e40e8a88">OVR::Timer::GetSeconds</a></div><div class="ttdeci">static double OVR_STDCALL GetSeconds()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Timer_8cpp_source.html#l00051">OVR_Timer.cpp:51</a></div></div>
<div class="ttc" id="classOVR_1_1DeviceBase_html_a62b09dddd0dd47eda68928cb4442b7a8"><div class="ttname"><a href="classOVR_1_1DeviceBase.html#a62b09dddd0dd47eda68928cb4442b7a8">OVR::DeviceBase::AddMessageHandler</a></div><div class="ttdeci">virtual void AddMessageHandler(MessageHandler *handler)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceImpl_8cpp_source.html#l00241">OVR_DeviceImpl.cpp:241</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_aee594dacfdbb6b8979c4c68e31fa898f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#aee594dacfdbb6b8979c4c68e31fa898f">OVR::SensorFusion::IsMotionTrackingEnabled</a></div><div class="ttdeci">bool IsMotionTrackingEnabled() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00236">OVR_SensorFusion.h:236</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a06d9b9e48a9191e791563eed848d3adb"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a06d9b9e48a9191e791563eed848d3adb">OVR::SensorFusion::OnVisionFailure</a></div><div class="ttdeci">virtual void OnVisionFailure()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00158">OVR_SensorFusion.cpp:158</a></div></div>
<div class="ttc" id="classOVR_1_1MessageHandler_html_a80b91de327dc246da0918c06f6561466"><div class="ttname"><a href="classOVR_1_1MessageHandler.html#a80b91de327dc246da0918c06f6561466">OVR::MessageHandler::RemoveHandlerFromDevices</a></div><div class="ttdeci">void RemoveHandlerFromDevices()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceImpl_8cpp_source.html#l00199">OVR_DeviceImpl.cpp:199</a></div></div>
<div class="ttc" id="classOVR_1_1Transform_html_aa9254092ecd7a15ceacb5761f7e7d0cf"><div class="ttname"><a href="classOVR_1_1Transform.html#aa9254092ecd7a15ceacb5761f7e7d0cf">OVR::Transform::Rotation</a></div><div class="ttdeci">Quat&lt; T &gt; Rotation</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01118">OVR_Math.h:1118</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a824ab65e488709381cd5ee9bf4d79d9f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a824ab65e488709381cd5ee9bf4d79d9f">OVR::SensorFusion::GetTime</a></div><div class="ttdeci">double GetTime() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00533">OVR_SensorFusion.h:533</a></div></div>
<div class="ttc" id="OVR__Log_8h_html"><div class="ttname"><a href="OVR__Log_8h.html">OVR_Log.h</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1LocklessState_html_a3580e1eb39e9f7d7e993471b4e2fecbd"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1LocklessState.html#a3580e1eb39e9f7d7e993471b4e2fecbd">OVR::SensorFusion::LocklessState::State</a></div><div class="ttdeci">PoseState&lt; double &gt; State</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00331">OVR_SensorFusion.h:331</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_a29cf6cfa0f46b92d67a0cca7b21cdad2"><div class="ttname"><a href="classOVR_1_1Vector3.html#a29cf6cfa0f46b92d67a0cca7b21cdad2">OVR::Vector3::Angle</a></div><div class="ttdeci">T Angle(const Vector3 &amp;b) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00497">OVR_Math.h:497</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFilterBase_html_aa20569b4bf8655426df713374c5ffbcb"><div class="ttname"><a href="classOVR_1_1SensorFilterBase.html#aa20569b4bf8655426df713374c5ffbcb">OVR::SensorFilterBase::PushBack</a></div><div class="ttdeci">void PushBack(const T &amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFilter_8h_source.html#l00054">OVR_SensorFilter.h:54</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html">OVR::MessageBodyFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00102">OVR_DeviceMessages.h:102</a></div></div>
<div class="ttc" id="structOVR_1_1PositionCalibrationReport_html_ab71a95755e9f74847fe67dee7cb67e87"><div class="ttname"><a href="structOVR_1_1PositionCalibrationReport.html#ab71a95755e9f74847fe67dee7cb67e87">OVR::PositionCalibrationReport::Angle</a></div><div class="ttdeci">double Angle</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Device_8h_source.html#l00728">OVR_Device.h:728</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html"><div class="ttname"><a href="classOVR_1_1Quat.html">OVR::Quat</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00121">OVR_Math.h:121</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_a3389286f7bdd77b20cd876433d831fd8"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#a3389286f7bdd77b20cd876433d831fd8">OVR::MessageBodyFrame::MagneticField</a></div><div class="ttdeci">Vector3f MagneticField</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00112">OVR_DeviceMessages.h:112</a></div></div>
<div class="ttc" id="namespaceOVR_1_1Recording_html_a2363f3b44afb29743651258207aaea16"><div class="ttname"><a href="namespaceOVR_1_1Recording.html#a2363f3b44afb29743651258207aaea16">OVR::Recording::GetRecorder</a></div><div class="ttdeci">OVR_FORCE_INLINE Recorder &amp; GetRecorder()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Recording_8h_source.html#l00077">OVR_Recording.h:77</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html"><div class="ttname"><a href="classOVR_1_1Vector3.html">OVR::Vector3&lt; double &gt;</a></div></div>
<div class="ttc" id="classOVR_1_1MessageBodyFrame_html_ac9b83cd080fa080e2eb3584c4f8e3862"><div class="ttname"><a href="classOVR_1_1MessageBodyFrame.html#ac9b83cd080fa080e2eb3584c4f8e3862">OVR::MessageBodyFrame::AbsoluteTimeSeconds</a></div><div class="ttdeci">double AbsoluteTimeSeconds</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00127">OVR_DeviceMessages.h:127</a></div></div>
<div class="ttc" id="structOVR_1_1SensorFusion_1_1MagReferencePoint_html"><div class="ttname"><a href="structOVR_1_1SensorFusion_1_1MagReferencePoint.html">OVR::SensorFusion::MagReferencePoint</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00367">OVR_SensorFusion.h:367</a></div></div>
<div class="ttc" id="classOVR_1_1MessageExposureFrame_html_ac71425fecc45a30a33c0e37ac666f647"><div class="ttname"><a href="classOVR_1_1MessageExposureFrame.html#ac71425fecc45a30a33c0e37ac666f647">OVR::MessageExposureFrame::CameraFrameCount</a></div><div class="ttdeci">UInt32 CameraFrameCount</div><div class="ttdef"><b>Definition:</b> <a href="OVR__DeviceMessages_8h_source.html#l00149">OVR_DeviceMessages.h:149</a></div></div>
<div class="ttc" id="namespaceOVR_html_a69d9da93ca851e0b09c0ed959c14751c"><div class="ttname"><a href="namespaceOVR.html#a69d9da93ca851e0b09c0ed959c14751c">OVR::Vector3f</a></div><div class="ttdeci">Vector3&lt; float &gt; Vector3f</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00554">OVR_Math.h:554</a></div></div>
<div class="ttc" id="classOVR_1_1Quat_html_a952058dc6770e67d43e43c82e8ce8e6c"><div class="ttname"><a href="classOVR_1_1Quat.html#a952058dc6770e67d43e43c82e8ce8e6c">OVR::Quat::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00698">OVR_Math.h:698</a></div></div>
<div class="ttc" id="classOVR_1_1SensorState_html_aebc870565f1b6f6884d7c0dca38825eb"><div class="ttname"><a href="classOVR_1_1SensorState.html#aebc870565f1b6f6884d7c0dca38825eb">OVR::SensorState::Magnetometer</a></div><div class="ttdeci">Vector3f Magnetometer</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00151">OVR_SensorFusion.h:151</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a2c4f002a2e5f5472b6ee6a60c901f6a7"><div class="ttname"><a href="classOVR_1_1PoseState.html#a2c4f002a2e5f5472b6ee6a60c901f6a7">OVR::PoseState::Pose</a></div><div class="ttdeci">Transform&lt; T &gt; Pose</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00092">OVR_SensorFusion.h:92</a></div></div>
<div class="ttc" id="OVR__SensorFusion_8cpp_html_a52715cbc385352dc231c7a4fc6093352"><div class="ttname"><a href="OVR__SensorFusion_8cpp.html#a52715cbc385352dc231c7a4fc6093352">TPH_IsPositionTracked</a></div><div class="ttdeci">bool TPH_IsPositionTracked</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00042">OVR_SensorFusion.cpp:42</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a6badd1ae3a0496bdc7a02760f36d6388"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a6badd1ae3a0496bdc7a02760f36d6388">OVR::SensorFusion::MagRefIdx</a></div><div class="ttdeci">int MagRefIdx</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00426">OVR_SensorFusion.h:426</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a53e554e06e7ab11ce6c1ee278a64c77c"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a53e554e06e7ab11ce6c1ee278a64c77c">OVR::SensorFusion::LastMessageExposureFrame</a></div><div class="ttdeci">MessageExposureFrame LastMessageExposureFrame</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00406">OVR_SensorFusion.h:406</a></div></div>
<div class="ttc" id="classOVR_1_1Vector3_html_ab43db723b9477d0a7d05bde2145829d8"><div class="ttname"><a href="classOVR_1_1Vector3.html#ab43db723b9477d0a7d05bde2145829d8">OVR::Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l00397">OVR_Math.h:397</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a87b974dd00d2eb452930a0363760a01e"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a87b974dd00d2eb452930a0363760a01e">OVR::SensorFusion::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00125">OVR_SensorFusion.cpp:125</a></div></div>
<div class="ttc" id="namespaceOVR_1_1Alg_html_a9a3c93262ebbe6e60d3e7f7594925df8"><div class="ttname"><a href="namespaceOVR_1_1Alg.html#a9a3c93262ebbe6e60d3e7f7594925df8">OVR::Alg::Abs</a></div><div class="ttdeci">OVR_FORCE_INLINE const T Abs(const T v)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__Alg_8h_source.html#l00079">OVR_Alg.h:79</a></div></div>
<div class="ttc" id="namespaceOVR_html_a50ee0d376336370e6b3f558de5bf5f17a1227c77b5df7b9964b69fe89b3386fe1"><div class="ttname"><a href="namespaceOVR.html#a50ee0d376336370e6b3f558de5bf5f17a1227c77b5df7b9964b69fe89b3386fe1">OVR::Status_OrientationTracked</a></div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00127">OVR_SensorFusion.h:127</a></div></div>
<div class="ttc" id="classOVR_1_1Transform_html_a6467e10df1ed045ae8f44cc9855d46ec"><div class="ttname"><a href="classOVR_1_1Transform.html#a6467e10df1ed045ae8f44cc9855d46ec">OVR::Transform::Rotate</a></div><div class="ttdeci">Vector3&lt; T &gt; Rotate(const Vector3&lt; T &gt; &amp;v) const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__Math_8h_source.html#l01121">OVR_Math.h:1121</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a9b9303b70599abece7c946420b787581"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a9b9303b70599abece7c946420b787581">OVR::SensorFusion::WorldFromCamera</a></div><div class="ttdeci">Transformd WorldFromCamera</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00431">OVR_SensorFusion.h:431</a></div></div>
<div class="ttc" id="classOVR_1_1PoseState_html_a0ac32680d9b3cf8fb7262b8317d0289b"><div class="ttname"><a href="classOVR_1_1PoseState.html#a0ac32680d9b3cf8fb7262b8317d0289b">OVR::PoseState::LinearAcceleration</a></div><div class="ttdeci">Vector3&lt; T &gt; LinearAcceleration</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00096">OVR_SensorFusion.h:96</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a5149ed10c172ccaa03651f626f68f95f"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a5149ed10c172ccaa03651f626f68f95f">OVR::SensorFusion::setNeckPivotFromPose</a></div><div class="ttdeci">void setNeckPivotFromPose(Transformd const &amp;pose)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00412">OVR_SensorFusion.cpp:412</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a14da5a89aab4b2a7f7ff920f81cab54b"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a14da5a89aab4b2a7f7ff920f81cab54b">OVR::SensorFusion::applyCameraTiltCorrection</a></div><div class="ttdeci">void applyCameraTiltCorrection(Vector3d accel, double deltaT)</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8cpp_source.html#l00608">OVR_SensorFusion.cpp:608</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_a6f2182008b38c1f61c9f59a0676f3487"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#a6f2182008b38c1f61c9f59a0676f3487">OVR::SensorFusion::IsAttachedToSensor</a></div><div class="ttdeci">bool IsAttachedToSensor() const </div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00483">OVR_SensorFusion.h:483</a></div></div>
<div class="ttc" id="classOVR_1_1SensorFusion_html_abf5f176885b366e72094a75b360666d9"><div class="ttname"><a href="classOVR_1_1SensorFusion.html#abf5f176885b366e72094a75b360666d9">OVR::SensorFusion::AccelOffset</a></div><div class="ttdeci">Vector3d AccelOffset</div><div class="ttdef"><b>Definition:</b> <a href="OVR__SensorFusion_8h_source.html#l00419">OVR_SensorFusion.h:419</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_6e08d1d846f66a2f1b7bfe6a7dd0639d.html">ovr</a></li><li class="navelem"><a class="el" href="dir_3ae17ad8ba81a0b7d9874ab5424b3896.html">sdk</a></li><li class="navelem"><a class="el" href="dir_1508c2002530895dcc543e52fe17c2ed.html">src</a></li><li class="navelem"><a class="el" href="OVR__SensorFusion_8cpp.html">OVR_SensorFusion.cpp</a></li>
    <li class="footer">Generated on Wed Oct 1 2014 00:45:20 for Bike-X by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
