<html>
<head>
<title>ovr/sdk/src/Kernel/OVR_Timer.cpp</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/215.html'>ovr</a>/<a href='../files/216.html'>sdk</a>/<a href='../files/218.html'>src</a>/<a href='../files/221.html'>Kernel</a>/OVR_Timer.cpp</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L51'>[^]</a><a href='#L263'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L51' title='Defined at 51.'>GetSeconds</a>
<li><a href='#L63' title='Defined at 63.'>initializeTimerSystem</a>
<li><a href='#L66' title='Defined at 66.'>shutdownTimerSystem</a>
<li><a href='#L79' title='Defined at 79.'>GetTicksNanos</a>
<li><a href='#L152' title='Defined at 152.'>Initialize</a>
<li><a href='#L160' title='Defined at 160.'>Shutdown</a>
<li><a href='#L166' title='Defined at 166.'>GetTimeNanos</a>
<li><a href='#L240' title='Defined at 240.'>GetTicksNanos</a>
<li><a href='#L247' title='Defined at 247.'>initializeTimerSystem</a>
<li><a href='#L252' title='Defined at 252.'>shutdownTimerSystem</a>
<li><a href='#L263' title='Defined at 263.'>GetTicksNanos</a>
</ol>
<hr>
<pre>
<a name='L1'>   1 <i><font color='green'>/************************************************************************************</font></i>
<a name='L2'>   2 <i><font color='green'></font></i>
<a name='L3'>   3 <i><font color='green'>Filename    :   OVR_Timer.cpp</font></i>
<a name='L4'>   4 <i><font color='green'>Content     :   Provides static functions for precise timing</font></i>
<a name='L5'>   5 <i><font color='green'>Created     :   September 19, 2012</font></i>
<a name='L6'>   6 <i><font color='green'>Notes       : </font></i>
<a name='L7'>   7 <i><font color='green'></font></i>
<a name='L8'>   8 <i><font color='green'>Copyright   :   Copyright 2014 Oculus VR, Inc. All Rights reserved.</font></i>
<a name='L9'>   9 <i><font color='green'></font></i>
<a name='L10'>  10 <i><font color='green'>Licensed under the Oculus VR Rift SDK License Version 3.1 (the "License"); </font></i>
<a name='L11'>  11 <i><font color='green'>you may not use the Oculus VR Rift SDK except in compliance with the License, </font></i>
<a name='L12'>  12 <i><font color='green'>which is provided at the time of installation or download, or which </font></i>
<a name='L13'>  13 <i><font color='green'>otherwise accompanies this software in either electronic or hard copy form.</font></i>
<a name='L14'>  14 <i><font color='green'></font></i>
<a name='L15'>  15 <i><font color='green'>You may obtain a copy of the License at</font></i>
<a name='L16'>  16 <i><font color='green'></font></i>
<a name='L17'>  17 <i><font color='green'>http://www.oculusvr.com/licenses/LICENSE-3.1 </font></i>
<a name='L18'>  18 <i><font color='green'></font></i>
<a name='L19'>  19 <i><font color='green'>Unless required by applicable law or agreed to in writing, the Oculus VR SDK </font></i>
<a name='L20'>  20 <i><font color='green'>distributed under the License is distributed on an "AS IS" BASIS,</font></i>
<a name='L21'>  21 <i><font color='green'>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</font></i>
<a name='L22'>  22 <i><font color='green'>See the License for the specific language governing permissions and</font></i>
<a name='L23'>  23 <i><font color='green'>limitations under the License.</font></i>
<a name='L24'>  24 <i><font color='green'></font></i>
<a name='L25'>  25 <i><font color='green'>************************************************************************************/</font></i>
<a name='L26'>  26 
<a name='L27'>  27 <font color='darkred'>#include</font> "<a href='185.html'>OVR_Timer.h</a>"
<a name='L28'>  28 <font color='darkred'>#include</font> "<a href='155.html'>OVR_Log.h</a>"
<a name='L29'>  29 
<a name='L30'>  30 <font color='darkred'>#if</font> <b>defined</b> (<a href='../D/776.html' title='Multiple defined in 2 places.'>OVR_OS_WIN32</a>)
<a name='L31'>  31 <font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L32'>  32 <font color='darkred'>#elif</font> <b>defined</b>(<a href='../S/168.html#L61' title='Defined at 61 in ovr/sdk/src/Kernel/OVR_Types.h.'>OVR_OS_ANDROID</a>)
<a name='L33'>  33 <font color='darkred'>#include</font> &lt;time.h&gt;
<a name='L34'>  34 <font color='darkred'>#include</font> &lt;android/log.h&gt;
<a name='L35'>  35 
<a name='L36'>  36 <font color='darkred'>#else</font>
<a name='L37'>  37 <font color='darkred'>#include</font> &lt;sys/time.h&gt;
<a name='L38'>  38 <font color='darkred'>#endif</font>
<a name='L39'>  39 
<a name='L40'>  40 <b>namespace</b> <a href='../R/624.html' title='Multiple refered from 184 places.'>OVR</a> <font color='red'>{</font>
<a name='L41'>  41 
<a name='L42'>  42 <i><font color='green'>// For recorded data playback</font></i>
<a name='L43'>  43 <b>bool</b>   <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../Y/4742.html' title='Multiple used in 7 places.'>useFakeSeconds</a>  = <b>false</b>; 
<a name='L44'>  44 <b>double</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../Y/581.html' title='Multiple used in 7 places.'>FakeSeconds</a>     = 0;
<a name='L45'>  45 
<a name='L46'>  46 
<a name='L47'>  47 <i><font color='green'>//------------------------------------------------------------------------</font></i>
<a name='L48'>  48 <i><font color='green'>// *** Timer - Platform Independent functions</font></i>
<a name='L49'>  49 
<a name='L50'>  50 <i><font color='green'>// Returns global high-resolution application timer in seconds.</font></i>
<a name='L51'>  51 <b>double</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/377.html' title='Multiple refered from 9 places.'>GetSeconds</a>()
<a name='L52'>  52 <font color='red'>{</font>
<a name='L53'>  53         <b>if</b>(<a href='../Y/4742.html' title='Multiple used in 7 places.'>useFakeSeconds</a>)
<a name='L54'>  54                 <b>return</b> <a href='../Y/581.html' title='Multiple used in 7 places.'>FakeSeconds</a>;
<a name='L55'>  55 
<a name='L56'>  56     <b>return</b> <b>double</b>(<a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../D/409.html' title='Multiple defined in 3 places.'>GetTicksNanos</a>()) * 0.000000001;
<a name='L57'>  57 <font color='red'>}</font>
<a name='L58'>  58 
<a name='L59'>  59 
<a name='L60'>  60 <font color='darkred'>#ifndef</font> <a href='../D/776.html' title='Multiple defined in 2 places.'>OVR_OS_WIN32</a>
<a name='L61'>  61 
<a name='L62'>  62 <i><font color='green'>// Unused on OSs other then Win32.</font></i>
<a name='L63'>  63 <b>void</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/1323.html' title='Multiple refered from 2 places.'>initializeTimerSystem</a>()
<a name='L64'>  64 <font color='red'>{</font>
<a name='L65'>  65 <font color='red'>}</font>
<a name='L66'>  66 <b>void</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/1465.html' title='Multiple refered from 2 places.'>shutdownTimerSystem</a>()
<a name='L67'>  67 <font color='red'>{</font>
<a name='L68'>  68 <font color='red'>}</font>
<a name='L69'>  69 
<a name='L70'>  70 <font color='darkred'>#endif</font>
<a name='L71'>  71 
<a name='L72'>  72 
<a name='L73'>  73 
<a name='L74'>  74 <i><font color='green'>//------------------------------------------------------------------------</font></i>
<a name='L75'>  75 <i><font color='green'>// *** Android Specific Timer</font></i>
<a name='L76'>  76 
<a name='L77'>  77 <font color='darkred'>#if</font> <b>defined</b>(<a href='../S/168.html#L61' title='Defined at 61 in ovr/sdk/src/Kernel/OVR_Types.h.'>OVR_OS_ANDROID</a>)
<a name='L78'>  78 
<a name='L79'>  79 <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/392.html' title='Multiple refered from 3 places.'>GetTicksNanos</a>()
<a name='L80'>  80 <font color='red'>{</font>
<a name='L81'>  81     <b>if</b> (<a href='../Y/4742.html' title='Multiple used in 7 places.'>useFakeSeconds</a>)
<a name='L82'>  82         <b>return</b> (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>) (<a href='../Y/581.html' title='Multiple used in 7 places.'>FakeSeconds</a> * <a href='../S/185.html#L46' title='Defined at 46 in ovr/sdk/src/Kernel/OVR_Timer.h.'>NanosPerSecond</a>);
<a name='L83'>  83 
<a name='L84'>  84     <i><font color='green'>// Choreographer vsync timestamp is based on.</font></i>
<a name='L85'>  85     <b>struct</b> <a href='../Y/4612.html' title='Multiple used in 2 places.'>timespec</a> <a href='../Y/4652.html' title='Multiple used in 15 places.'>tp</a>;
<a name='L86'>  86     <b>const</b> <b>int</b>       <a href='../Y/4470.html' title='Multiple used in 5 places.'>status</a> = clock_gettime(CLOCK_MONOTONIC, &amp;<a href='../Y/4652.html' title='Multiple used in 15 places.'>tp</a>);
<a name='L87'>  87 
<a name='L88'>  88     <b>if</b> (<a href='../Y/4470.html' title='Multiple used in 5 places.'>status</a> != 0)
<a name='L89'>  89     <font color='red'>{</font>
<a name='L90'>  90         <a href='../D/704.html' title='Multiple defined in 2 places.'>OVR_DEBUG_LOG</a>(("clock_gettime status=%i", <a href='../Y/4470.html' title='Multiple used in 5 places.'>status</a> ));
<a name='L91'>  91     <font color='red'>}</font>
<a name='L92'>  92     <b>const</b> <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a> = (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>)<a href='../Y/4652.html' title='Multiple used in 15 places.'>tp</a>.<a href='../Y/4663.html' title='Multiple used in 4 places.'>tv_sec</a> * (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>)(1000 * 1000 * 1000) + <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>(<a href='../Y/4652.html' title='Multiple used in 15 places.'>tp</a>.<a href='../Y/4662.html' title='Multiple used in 4 places.'>tv_nsec</a>);
<a name='L93'>  93     <b>return</b> <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a>;
<a name='L94'>  94 <font color='red'>}</font>
<a name='L95'>  95 
<a name='L96'>  96 
<a name='L97'>  97 <i><font color='green'>//------------------------------------------------------------------------</font></i>
<a name='L98'>  98 <i><font color='green'>// *** Win32 Specific Timer</font></i>
<a name='L99'>  99 
<a name='L100'> 100 <font color='darkred'>#elif</font> <b>defined</b> (<a href='../D/776.html' title='Multiple defined in 2 places.'>OVR_OS_WIN32</a>)
<a name='L101'> 101 
<a name='L102'> 102 
<a name='L103'> 103 <i><font color='green'>// This helper class implements high-resolution wrapper that combines timeGetTime() output</font></i>
<a name='L104'> 104 <i><font color='green'>// with QueryPerformanceCounter.  timeGetTime() is lower precision but drives the high bits,</font></i>
<a name='L105'> 105 <i><font color='green'>// as it's tied to the system clock.</font></i>
<a name='L106'> 106 <b>struct</b> <a href='../R/824.html' title='Multiple refered from 5 places.'>PerformanceTimer</a>
<a name='L107'> 107 <font color='red'>{</font>
<a name='L108'> 108     <a href='../S/153.html#L106' title='Defined at 106 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>PerformanceTimer</a>()
<a name='L109'> 109         : <a href='../Y/1538.html' title='Multiple used in 4 places.'>OldMMTimeMs</a>(0), <a href='../Y/1333.html' title='Multiple used in 5 places.'>MMTimeWrapCounter</a>(0), <a href='../Y/1694.html' title='Multiple used in 5 places.'>PrefFrequency</a>(0),
<a name='L110'> 110           <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>(0), <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a>(0)
<a name='L111'> 111     <font color='red'>{</font> <font color='red'>}</font>
<a name='L112'> 112     
<a name='L113'> 113     <b>enum</b> <font color='red'>{</font>
<a name='L114'> 114         <a href='../R/559.html' title='Multiple refered from 4 places.'>MMTimerResolutionNanos</a> = 1000000
<a name='L115'> 115     <font color='red'>}</font>;
<a name='L116'> 116    
<a name='L117'> 117     <b>void</b>    <a href='../D/475.html' title='Multiple defined in 10 places.'>Initialize</a>();
<a name='L118'> 118     <b>void</b>    <a href='../D/1108.html' title='Multiple defined in 7 places.'>Shutdown</a>();
<a name='L119'> 119 
<a name='L120'> 120     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../S/153.html#L166' title='Defined at 166 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>GetTimeNanos</a>();
<a name='L121'> 121 
<a name='L122'> 122 
<a name='L123'> 123     UINT64 <a href='../Y/3290.html' title='Multiple used in 3 places.'>getFrequency</a>()
<a name='L124'> 124     <font color='red'>{</font>
<a name='L125'> 125         <b>if</b> (<a href='../Y/1694.html' title='Multiple used in 5 places.'>PrefFrequency</a> == 0)
<a name='L126'> 126         <font color='red'>{</font>
<a name='L127'> 127             <a href='../Y/1188.html' title='Multiple used in 2 places.'>LARGE_INTEGER</a> <a href='../Y/3264.html' title='Multiple used in 3 places.'>freq</a>;
<a name='L128'> 128             QueryPerformanceFrequency(&amp;<a href='../Y/3264.html' title='Multiple used in 3 places.'>freq</a>);
<a name='L129'> 129             <a href='../Y/1694.html' title='Multiple used in 5 places.'>PrefFrequency</a> = <a href='../Y/3264.html' title='Multiple used in 3 places.'>freq</a>.<a href='../Y/1745.html' title='Multiple used in 3 places.'>QuadPart</a>;
<a name='L130'> 130         <font color='red'>}</font>        
<a name='L131'> 131         <b>return</b> <a href='../Y/1694.html' title='Multiple used in 5 places.'>PrefFrequency</a>;
<a name='L132'> 132     <font color='red'>}</font>
<a name='L133'> 133     
<a name='L134'> 134 
<a name='L135'> 135     <a href='../Y/171.html' title='Multiple used in 2 places.'>CRITICAL_SECTION</a> <a href='../Y/2251.html' title='Multiple used in 5 places.'>TimeCS</a>;
<a name='L136'> 136     <i><font color='green'>// timeGetTime() support with wrap.</font></i>
<a name='L137'> 137     <a href='../D/1214.html' title='Multiple defined in 3 places.'>UInt32</a>          <a href='../Y/1538.html' title='Multiple used in 4 places.'>OldMMTimeMs</a>;
<a name='L138'> 138     <a href='../D/1214.html' title='Multiple defined in 3 places.'>UInt32</a>          <a href='../Y/1333.html' title='Multiple used in 5 places.'>MMTimeWrapCounter</a>;
<a name='L139'> 139     <i><font color='green'>// Cached performance frequency result.</font></i>
<a name='L140'> 140     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>          <a href='../Y/1694.html' title='Multiple used in 5 places.'>PrefFrequency</a>;
<a name='L141'> 141     
<a name='L142'> 142     <i><font color='green'>// Computed as (perfCounterNanos - ticksCounterNanos) initially,</font></i>
<a name='L143'> 143     <i><font color='green'>// and used to adjust timing.</font></i>
<a name='L144'> 144     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>          <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a>;
<a name='L145'> 145     <i><font color='green'>// Last returned value in nanoseconds, to ensure we don't back-step in time.</font></i>
<a name='L146'> 146     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>          <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>;
<a name='L147'> 147 <font color='red'>}</font>;
<a name='L148'> 148 
<a name='L149'> 149 <a href='../S/153.html#L106' title='Defined at 106 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>PerformanceTimer</a> <a href='../Y/2442.html' title='Multiple used in 4 places.'>Win32_PerfTimer</a>;
<a name='L150'> 150 
<a name='L151'> 151 
<a name='L152'> 152 <b>void</b> <a href='../S/153.html#L106' title='Defined at 106 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>PerformanceTimer</a>::<a href='../R/458.html' title='Multiple refered from 25 places.'>Initialize</a>()
<a name='L153'> 153 <font color='red'>{</font>
<a name='L154'> 154     timeBeginPeriod(1);
<a name='L155'> 155     <a href='../Y/987.html' title='Multiple used in 2 places.'>InitializeCriticalSection</a>(&amp;<a href='../Y/2251.html' title='Multiple used in 5 places.'>TimeCS</a>);
<a name='L156'> 156     <a href='../Y/1333.html' title='Multiple used in 5 places.'>MMTimeWrapCounter</a> = 0;
<a name='L157'> 157     <a href='../Y/3290.html' title='Multiple used in 3 places.'>getFrequency</a>();
<a name='L158'> 158 <font color='red'>}</font>
<a name='L159'> 159 
<a name='L160'> 160 <b>void</b> <a href='../S/153.html#L106' title='Defined at 106 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>PerformanceTimer</a>::<a href='../R/1042.html' title='Multiple refered from 14 places.'>Shutdown</a>()
<a name='L161'> 161 <font color='red'>{</font>
<a name='L162'> 162     <a href='../Y/365.html' title='Multiple used in 2 places.'>DeleteCriticalSection</a>(&amp;<a href='../Y/2251.html' title='Multiple used in 5 places.'>TimeCS</a>);
<a name='L163'> 163     timeEndPeriod(1);
<a name='L164'> 164 <font color='red'>}</font>
<a name='L165'> 165 
<a name='L166'> 166 <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../S/153.html#L106' title='Defined at 106 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>PerformanceTimer</a>::<a href='../R/393.html' title='Multiple refered from 2 places.'>GetTimeNanos</a>()
<a name='L167'> 167 <font color='red'>{</font>
<a name='L168'> 168     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>          <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L169'> 169     <a href='../Y/1188.html' title='Multiple used in 2 places.'>LARGE_INTEGER</a>   <a href='../Y/3568.html' title='Multiple used in 4 places.'>li</a>;
<a name='L170'> 170     <a href='../Y/331.html' title='Multiple used in 4 places.'>DWORD</a>           <a href='../Y/3696.html' title='Multiple used in 5 places.'>mmTimeMs</a>;
<a name='L171'> 171 
<a name='L172'> 172     <i><font color='green'>// On Win32 QueryPerformanceFrequency is unreliable due to SMP and</font></i>
<a name='L173'> 173     <i><font color='green'>// performance levels, so use this logic to detect wrapping and track</font></i>
<a name='L174'> 174     <i><font color='green'>// high bits.</font></i>
<a name='L175'> 175     ::<a href='../Y/503.html' title='Multiple used in 2 places.'>EnterCriticalSection</a>(&amp;<a href='../Y/2251.html' title='Multiple used in 5 places.'>TimeCS</a>);
<a name='L176'> 176 
<a name='L177'> 177     <i><font color='green'>// Get raw value and perf counter "At the same time".</font></i>
<a name='L178'> 178     <a href='../Y/3696.html' title='Multiple used in 5 places.'>mmTimeMs</a> = timeGetTime();
<a name='L179'> 179     QueryPerformanceCounter(&amp;<a href='../Y/3568.html' title='Multiple used in 4 places.'>li</a>);
<a name='L180'> 180 
<a name='L181'> 181     <b>if</b> (<a href='../Y/1538.html' title='Multiple used in 4 places.'>OldMMTimeMs</a> &gt; <a href='../Y/3696.html' title='Multiple used in 5 places.'>mmTimeMs</a>)
<a name='L182'> 182         <a href='../Y/1333.html' title='Multiple used in 5 places.'>MMTimeWrapCounter</a>++;
<a name='L183'> 183     <a href='../Y/1538.html' title='Multiple used in 4 places.'>OldMMTimeMs</a> = <a href='../Y/3696.html' title='Multiple used in 5 places.'>mmTimeMs</a>;
<a name='L184'> 184 
<a name='L185'> 185     <i><font color='green'>// Normalize to nanoseconds.</font></i>
<a name='L186'> 186     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a>     = ((<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>(<a href='../Y/1333.html' title='Multiple used in 5 places.'>MMTimeWrapCounter</a>) &lt;&lt; 32) | <a href='../Y/3696.html' title='Multiple used in 5 places.'>mmTimeMs</a>) * 1000000;
<a name='L187'> 187     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../Y/3265.html' title='Multiple used in 7 places.'>frequency</a>          = <a href='../Y/3290.html' title='Multiple used in 3 places.'>getFrequency</a>();
<a name='L188'> 188     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../Y/4034.html' title='Multiple used in 3 places.'>perfCounterSeconds</a> = <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>(<a href='../Y/3568.html' title='Multiple used in 4 places.'>li</a>.<a href='../Y/1745.html' title='Multiple used in 3 places.'>QuadPart</a>) / <a href='../Y/3265.html' title='Multiple used in 7 places.'>frequency</a>;
<a name='L189'> 189     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../Y/4035.html' title='Multiple used in 2 places.'>perfRemainderNanos</a> = ( (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>(<a href='../Y/3568.html' title='Multiple used in 4 places.'>li</a>.<a href='../Y/1745.html' title='Multiple used in 3 places.'>QuadPart</a>) - <a href='../Y/4034.html' title='Multiple used in 3 places.'>perfCounterSeconds</a> * <a href='../Y/3265.html' title='Multiple used in 7 places.'>frequency</a>) *
<a name='L190'> 190                                    <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../S/185.html#L46' title='Defined at 46 in ovr/sdk/src/Kernel/OVR_Timer.h.'>NanosPerSecond</a> ) / <a href='../Y/3265.html' title='Multiple used in 7 places.'>frequency</a>;
<a name='L191'> 191     <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>  <a href='../Y/4033.html' title='Multiple used in 5 places.'>perfCounterNanos</a>   = <a href='../Y/4034.html' title='Multiple used in 3 places.'>perfCounterSeconds</a> * <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../S/185.html#L46' title='Defined at 46 in ovr/sdk/src/Kernel/OVR_Timer.h.'>NanosPerSecond</a> + <a href='../Y/4035.html' title='Multiple used in 2 places.'>perfRemainderNanos</a>;
<a name='L192'> 192 
<a name='L193'> 193     <b>if</b> (<a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a> == 0)
<a name='L194'> 194         <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a> = <a href='../Y/4033.html' title='Multiple used in 5 places.'>perfCounterNanos</a> - <a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a>;
<a name='L195'> 195  
<a name='L196'> 196 
<a name='L197'> 197     <i><font color='green'>// Compute result before snapping. </font></i>
<a name='L198'> 198     <i><font color='green'>//</font></i>
<a name='L199'> 199     <i><font color='green'>// On first call, this evaluates to:</font></i>
<a name='L200'> 200     <i><font color='green'>//          resultNanos = mmCounterNanos.    </font></i>
<a name='L201'> 201     <i><font color='green'>// Next call, assuming no wrap:</font></i>
<a name='L202'> 202     <i><font color='green'>//          resultNanos = prev_mmCounterNanos + (perfCounterNanos - prev_perfCounterNanos).        </font></i>
<a name='L203'> 203     <i><font color='green'>// After wrap, this would be:</font></i>
<a name='L204'> 204     <i><font color='green'>//          resultNanos = snapped(prev_mmCounterNanos +/- 1ms) + (perfCounterNanos - prev_perfCounterNanos).</font></i>
<a name='L205'> 205     <i><font color='green'>//</font></i>
<a name='L206'> 206     <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> = <a href='../Y/4033.html' title='Multiple used in 5 places.'>perfCounterNanos</a> - <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a>;    
<a name='L207'> 207 
<a name='L208'> 208     <i><font color='green'>// Snap the range so that resultNanos never moves further apart then its target resolution.</font></i>
<a name='L209'> 209     <i><font color='green'>// It's better to allow more slack on the high side as timeGetTime() may be updated at sporadically </font></i>
<a name='L210'> 210     <i><font color='green'>// larger then 1 ms intervals even when 1 ms resolution is requested.</font></i>
<a name='L211'> 211     <b>if</b> (<a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> &gt; (<a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a> + <a href='../S/153.html#L114' title='Defined at 114 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>MMTimerResolutionNanos</a>*2))
<a name='L212'> 212     <font color='red'>{</font>
<a name='L213'> 213         <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> = <a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a> + <a href='../S/153.html#L114' title='Defined at 114 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>MMTimerResolutionNanos</a>*2;
<a name='L214'> 214         <b>if</b> (<a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> &lt; <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>)
<a name='L215'> 215             <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> = <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>;
<a name='L216'> 216         <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a> = <a href='../Y/4033.html' title='Multiple used in 5 places.'>perfCounterNanos</a> - <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L217'> 217     <font color='red'>}</font>
<a name='L218'> 218     <b>else</b> <b>if</b> (<a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> &lt; (<a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a> - <a href='../S/153.html#L114' title='Defined at 114 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>MMTimerResolutionNanos</a>))
<a name='L219'> 219     <font color='red'>{</font>
<a name='L220'> 220         <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> = <a href='../Y/3695.html' title='Multiple used in 6 places.'>mmCounterNanos</a> - <a href='../S/153.html#L114' title='Defined at 114 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>MMTimerResolutionNanos</a>;
<a name='L221'> 221         <b>if</b> (<a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> &lt; <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>)
<a name='L222'> 222             <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> = <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a>;
<a name='L223'> 223         <a href='../Y/1657.html' title='Multiple used in 7 places.'>PerfMinusTicksDeltaNanos</a> = <a href='../Y/4033.html' title='Multiple used in 5 places.'>perfCounterNanos</a> - <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L224'> 224     <font color='red'>}</font>
<a name='L225'> 225 
<a name='L226'> 226     <a href='../Y/1221.html' title='Multiple used in 7 places.'>LastResultNanos</a> = <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L227'> 227     ::<a href='../Y/1264.html' title='Multiple used in 2 places.'>LeaveCriticalSection</a>(&amp;<a href='../Y/2251.html' title='Multiple used in 5 places.'>TimeCS</a>);
<a name='L228'> 228 
<a name='L229'> 229         <i><font color='green'>//Tom's addition, to keep precision</font></i>
<a name='L230'> 230         <b>static</b> <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>      <a href='../Y/3465.html' title='Multiple used in 3 places.'>initial_time</a> = 0;
<a name='L231'> 231         <b>if</b> (!<a href='../Y/3465.html' title='Multiple used in 3 places.'>initial_time</a>) <a href='../Y/3465.html' title='Multiple used in 3 places.'>initial_time</a> = <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L232'> 232         <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a> -= <a href='../Y/3465.html' title='Multiple used in 3 places.'>initial_time</a>;
<a name='L233'> 233 
<a name='L234'> 234 
<a name='L235'> 235     <b>return</b> <a href='../Y/4296.html' title='Multiple used in 16 places.'>resultNanos</a>;
<a name='L236'> 236 <font color='red'>}</font>
<a name='L237'> 237 
<a name='L238'> 238 
<a name='L239'> 239 <i><font color='green'>// Delegate to PerformanceTimer.</font></i>
<a name='L240'> 240 <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/392.html' title='Multiple refered from 3 places.'>GetTicksNanos</a>()
<a name='L241'> 241 <font color='red'>{</font>
<a name='L242'> 242     <b>if</b> (<a href='../Y/4742.html' title='Multiple used in 7 places.'>useFakeSeconds</a>)
<a name='L243'> 243         <b>return</b> (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>) (<a href='../Y/581.html' title='Multiple used in 7 places.'>FakeSeconds</a> * <a href='../S/185.html#L46' title='Defined at 46 in ovr/sdk/src/Kernel/OVR_Timer.h.'>NanosPerSecond</a>);
<a name='L244'> 244 
<a name='L245'> 245     <b>return</b> <a href='../Y/2442.html' title='Multiple used in 4 places.'>Win32_PerfTimer</a>.<a href='../S/153.html#L166' title='Defined at 166 in ovr/sdk/src/Kernel/OVR_Timer.cpp.'>GetTimeNanos</a>();
<a name='L246'> 246 <font color='red'>}</font>
<a name='L247'> 247 <b>void</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/1323.html' title='Multiple refered from 2 places.'>initializeTimerSystem</a>()
<a name='L248'> 248 <font color='red'>{</font>
<a name='L249'> 249     <a href='../Y/2442.html' title='Multiple used in 4 places.'>Win32_PerfTimer</a>.<a href='../D/475.html' title='Multiple defined in 10 places.'>Initialize</a>();
<a name='L250'> 250 
<a name='L251'> 251 <font color='red'>}</font>
<a name='L252'> 252 <b>void</b> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/1465.html' title='Multiple refered from 2 places.'>shutdownTimerSystem</a>()
<a name='L253'> 253 <font color='red'>{</font>
<a name='L254'> 254     <a href='../Y/2442.html' title='Multiple used in 4 places.'>Win32_PerfTimer</a>.<a href='../D/1108.html' title='Multiple defined in 7 places.'>Shutdown</a>();
<a name='L255'> 255 <font color='red'>}</font>
<a name='L256'> 256 
<a name='L257'> 257 <font color='darkred'>#else</font>   <i><font color='green'>// !OVR_OS_WIN32 &amp;&amp; !OVR_OS_ANDROID</font></i>
<a name='L258'> 258 
<a name='L259'> 259 
<a name='L260'> 260 <i><font color='green'>//------------------------------------------------------------------------</font></i>
<a name='L261'> 261 <i><font color='green'>// *** Standard OS Timer     </font></i>
<a name='L262'> 262 
<a name='L263'> 263 <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../Y/2261.html' title='Multiple used in 29 places.'>Timer</a>::<a href='../R/392.html' title='Multiple refered from 3 places.'>GetTicksNanos</a>()
<a name='L264'> 264 <font color='red'>{</font>
<a name='L265'> 265     <b>if</b> (<a href='../Y/4742.html' title='Multiple used in 7 places.'>useFakeSeconds</a>)
<a name='L266'> 266         <b>return</b> (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>) (<a href='../Y/581.html' title='Multiple used in 7 places.'>FakeSeconds</a> * <a href='../S/185.html#L46' title='Defined at 46 in ovr/sdk/src/Kernel/OVR_Timer.h.'>NanosPerSecond</a>);
<a name='L267'> 267 
<a name='L268'> 268     <i><font color='green'>// TODO: prefer rdtsc when available?</font></i>
<a name='L269'> 269         <a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a> <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a>;
<a name='L270'> 270 
<a name='L271'> 271     <i><font color='green'>// Return microseconds.</font></i>
<a name='L272'> 272     <b>struct</b> <a href='../Y/4616.html' title='Multiple used in 2 places.'>timeval</a> <a href='../Y/4661.html' title='Multiple used in 8 places.'>tv</a>;
<a name='L273'> 273 
<a name='L274'> 274     <a href='../Y/3297.html' title='Multiple used in 2 places.'>gettimeofday</a>(&amp;<a href='../Y/4661.html' title='Multiple used in 8 places.'>tv</a>, 0);
<a name='L275'> 275 
<a name='L276'> 276     <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a> = (<a href='../D/1215.html' title='Multiple defined in 3 places.'>UInt64</a>)<a href='../Y/4661.html' title='Multiple used in 8 places.'>tv</a>.<a href='../Y/4663.html' title='Multiple used in 4 places.'>tv_sec</a> * 1000000;
<a name='L277'> 277     <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a> += <a href='../Y/4661.html' title='Multiple used in 8 places.'>tv</a>.<a href='../Y/4664.html' title='Multiple used in 2 places.'>tv_usec</a>;
<a name='L278'> 278 
<a name='L279'> 279     <b>return</b> <a href='../Y/4291.html' title='Multiple used in 413 places.'>result</a> * 1000;
<a name='L280'> 280 <font color='red'>}</font>
<a name='L281'> 281 
<a name='L282'> 282 <font color='darkred'>#endif</font>  <i><font color='green'>// OS-specific</font></i>
<a name='L283'> 283 
<a name='L284'> 284 
<a name='L285'> 285 
<a name='L286'> 286 <font color='red'>}</font> <i><font color='green'>// OVR</font></i>
<a name='L287'> 287 
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L51'>[^]</a><a href='#L263'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
